{"version":3,"file":"grid-item.vue.mjs","sources":["../../src/components/grid-item.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\n/**\r\n * GridItem 组件（单个网格子项）\r\n * 职责概述：\r\n * 1. 接收父级 GridLayout 注入的布局环境（列数、容器宽度、行高、间距、交互开关等）并与自身 props 合并。\r\n * 2. 将网格坐标 (x,y,w,h) 与像素定位/尺寸互相转换：calcPosition -> 网格单位转像素；calcXY/calcWH -> 像素转网格单位。\r\n * 3. 管理拖拽与缩放交互（基于 interactjs），在 drag/resize 三阶段中维护临时状态并派发事件：move/moved、resize/resized。\r\n * 4. 支持 RTL 与镜像模式：通过 renderRtl 计算对 left/right 的差异处理，以及使用 setTransformRtl / setTopRight。\r\n * 5. 支持受限（bounded）拖拽：根据当前容器宽高边界裁剪拖拽结果（clamp）。\r\n * 6. 在外部环境变化（列数、容器宽度、行高、间距、交互开关等）时，自动重建样式（createStyle）确保表现同步。\r\n * 7. 对最小/最大尺寸、纵向/横向约束做统一裁剪，避免越界与非法区域。\r\n * 8. 通过事件总线 (emitter) 与父布局协同：监听 updateWidth/compact 等指令；向父布局广播 dragEvent/resizeEvent 阶段事件。\r\n */\r\n\r\nimport {\r\n  computed,\r\n  inject,\r\n  onBeforeMount,\r\n  onBeforeUnmount,\r\n  onMounted,\r\n  reactive,\r\n  ref,\r\n  shallowRef,\r\n  toRef,\r\n  watch,\r\n  watchEffect,\r\n} from 'vue'\r\n\r\nimport { isNull, nextTickOnce, throttle } from '@vexip-ui/utils'\r\nimport {\r\n  EMITTER_KEY,\r\n  LAYOUT_KEY,\r\n  setTopLeft,\r\n  setTopRight,\r\n  setTransform,\r\n  setTransformRtl,\r\n  useNameHelper,\r\n} from '../helpers/common'\r\nimport { createCoreData, getControlPosition } from '../helpers/draggable'\r\nimport { getColsFromBreakpoint } from '../helpers/responsive'\r\nimport { getDocumentDir } from '../helpers/dom'\r\n\r\nimport interact from 'interactjs'\r\n\r\nimport type { GridItemProps } from './types'\r\n\r\nconst props = withDefaults(defineProps<GridItemProps>(), {\r\n  isDraggable: undefined, // 可拖拽覆盖父级，undefined 继承父级，false 禁止拖动\r\n  isResizable: undefined, // 可缩放覆盖父级，undefined 继承父级，false 禁止缩放\r\n  isBounded: undefined, // 是否受容器边界限制，undefined 继承父级，true 使用 clamp 截断\r\n  static: false, // 静态模式：禁用拖拽与缩放且不参与压缩\r\n  minH: 1, // 最小高度(行数)\r\n  minW: 1, // 最小宽度(列数)\r\n  maxH: Infinity, // 最大高度(行数) Infinity 不限制\r\n  maxW: Infinity, // 最大宽度(列数) Infinity 不限制\r\n  dragIgnoreFrom: 'a, button', // 拖拽忽略选择器，逗号分隔\r\n  dragAllowFrom: undefined, // 仅允许拖拽的起始选择器，设置后其它区域不可拖拽\r\n  resizeIgnoreFrom: 'a, button', // 缩放忽略选择器\r\n  preserveAspectRatio: false, // 是否保持宽高比\r\n  dragOption: () => ({}), // 额外拖拽配置透传 interact.draggable\r\n  resizeOption: () => ({}), // 额外缩放配置透传 interact.resizable\r\n})\r\n\r\nconst emit = defineEmits(['container-resized', 'resize', 'resized', 'move', 'moved'])\r\n\r\nconst layout = inject(LAYOUT_KEY)\r\nconst emitter = inject(EMITTER_KEY)!\r\n\r\nif (!layout) {\r\n  throw new Error('[grid-layout-plus]: missing layout store, GridItem must under a GridLayout.')\r\n}\r\n\r\nconst interactObj = shallowRef<InstanceType<\r\n  typeof import('@interactjs/types').Interactable\r\n> | null>(null)\r\n\r\nconst state = reactive({\r\n  cols: 1,\r\n  containerWidth: 100,\r\n  rowHeight: 30,\r\n  margin: [10, 10],\r\n  maxRows: Infinity,\r\n  draggable: undefined as boolean | undefined,\r\n  resizable: undefined as boolean | undefined,\r\n  bounded: undefined as boolean | undefined,\r\n  transformScale: 1,\r\n  useCssTransforms: true,\r\n  useStyleCursor: true,\r\n\r\n  isDragging: false,\r\n  dragging: {\r\n    top: -1,\r\n    left: -1,\r\n  },\r\n  isResizing: false,\r\n  resizing: {\r\n    width: -1,\r\n    height: -1,\r\n  },\r\n  style: {} as Record<string, string>,\r\n  rtl: false,\r\n  // 新增：当前正在被缩放的边，用于视觉高亮\r\n  activeResizeEdges: {\r\n    top: false,\r\n    right: false,\r\n    bottom: false,\r\n    left: false,\r\n  },\r\n  // 新增：有效的可缩放边（根据最终 resize 配置计算）\r\n  enabledResizeEdges: {\r\n    top: false,\r\n    right: false,\r\n    bottom: false,\r\n    left: false,\r\n  },\r\n})\r\n\r\nlet dragEventSet = false\r\nlet resizeEventSet = false\r\n\r\nlet lastX = NaN\r\nlet lastY = NaN\r\nlet lastW = NaN\r\nlet lastH = NaN\r\n\r\nlet previousW = -1\r\nlet previousH = -1\r\nlet previousX = -1\r\nlet previousY = -1\r\n\r\nlet innerX = props.x\r\nlet innerY = props.y\r\nlet innerW = props.w\r\nlet innerH = props.h\r\n\r\nconst wrapper = ref<HTMLElement>()\r\n\r\nconst instance = reactive({\r\n  i: toRef(props, 'i'),\r\n  state,\r\n  wrapper,\r\n  calcXY,\r\n})\r\n\r\n/**\r\n * 接收父布局广播的宽度变化并更新内部 containerWidth。\r\n * 会间接影响列宽计算与拖拽/缩放像素换算。\r\n * @param width 新容器宽度（像素）\r\n */\r\nfunction updateWidthHandler(width: number) {\r\n  updateWidth(width)\r\n}\r\n\r\n/**\r\n * 父布局触发压缩后同步当前项样式。\r\n */\r\nfunction compactHandler() {\r\n  compact()\r\n}\r\n\r\n/**\r\n * 设置本项是否可拖拽（仅在未显式传入 isDraggable 时生效继承）。\r\n * @param isDraggable 是否可拖拽\r\n */\r\nfunction setDraggableHandler(isDraggable: boolean) {\r\n  if (isNull(props.isDraggable)) {\r\n    state.draggable = isDraggable\r\n  }\r\n}\r\n\r\n/**\r\n * 设置本项是否可缩放（仅在未显式传入 isResizable 时生效继承）。\r\n * @param isResizable 是否可缩放\r\n */\r\nfunction setResizableHandler(isResizable: boolean) {\r\n  if (isNull(props.isResizable)) {\r\n    state.resizable = isResizable\r\n  }\r\n}\r\n\r\n/**\r\n * 设置本项是否受容器边界限制（仅在未显式传入 isBounded 时生效继承）。\r\n * @param isBounded 是否受限\r\n */\r\nfunction setBoundedHandler(isBounded: boolean) {\r\n  if (isNull(props.isBounded)) {\r\n    state.bounded = isBounded\r\n  }\r\n}\r\n\r\n/**\r\n * 同步缩放比例，用于拖拽/缩放增量换算。\r\n * @param transformScale 缩放比\r\n */\r\nfunction setTransformScaleHandler(transformScale: number) {\r\n  state.transformScale = transformScale\r\n}\r\n\r\n/**\r\n * 同步行高后用于像素与网格单位之间的转换。\r\n * @param rowHeight 行高（像素）\r\n */\r\nfunction setRowHeightHandler(rowHeight: number) {\r\n  state.rowHeight = rowHeight\r\n}\r\n\r\n/**\r\n * 同步最大允许行数限制。\r\n * @param maxRows 最大行数\r\n */\r\nfunction setMaxRowsHandler(maxRows: number) {\r\n  state.maxRows = maxRows\r\n}\r\n\r\n/**\r\n * 文档方向变化（LTR/RTL）处理。\r\n */\r\nfunction directionchangeHandler() {\r\n  state.rtl = getDocumentDir() === 'rtl'\r\n  compact()\r\n}\r\n\r\n/**\r\n * 更新列数并向下影响列宽计算。\r\n * @param colNum 新列数\r\n */\r\nfunction setColNum(colNum: number) {\r\n  state.cols = Math.floor(colNum)\r\n}\r\n\r\nlayout.increaseItem(instance)\r\n\r\n/**\r\n * onBeforeMount\r\n * 在组件挂载前读取当前文档方向（LTR/RTL），以便首帧渲染就使用正确的 rtl 标记。\r\n * 仅设置一次初始 state.rtl，后续方向变化由 directionchangeHandler 处理。\r\n */\r\nonBeforeMount(() => {\r\n  state.rtl = getDocumentDir() === 'rtl'\r\n})\r\n\r\n/**\r\n * onMounted\r\n * 完整初始化运行态：\r\n * 1. 根据是否启用响应式及最近断点确定初始列数 cols；\r\n * 2. 同步父布局提供的行高、容器宽度、间距、最大行数等基础尺寸；\r\n * 3. 以“局部覆盖优先”策略合并拖拽/缩放/边界/缩放比等交互配置；\r\n * 4. 开启 watchEffect，监听传入的 x,y,w,h 变化并重建样式；\r\n * 5. 绑定来自父布局的事件（updateWidth/compact/...）实现后续响应；\r\n * 通过这些步骤使 GridItem 在首帧后即可准确呈现，并能对后续布局/环境变化即时响应。\r\n */\r\nonMounted(() => {\r\n  if (layout.responsive && layout.lastBreakpoint) {\r\n    state.cols = getColsFromBreakpoint(layout.lastBreakpoint, layout.cols)\r\n  } else {\r\n    state.cols = layout.colNum\r\n  }\r\n  state.rowHeight = layout.rowHeight\r\n  state.containerWidth = layout.width !== null ? layout.width : 100\r\n  state.margin = layout.margin !== undefined ? layout.margin.map(Number) : [10, 10]\r\n  state.maxRows = layout.maxRows\r\n\r\n  if (isNull(props.isDraggable)) {\r\n    state.draggable = layout.isDraggable\r\n  } else {\r\n    state.draggable = props.isDraggable\r\n  }\r\n  if (isNull(props.isResizable)) {\r\n    state.resizable = layout.isResizable\r\n  } else {\r\n    state.resizable = props.isResizable\r\n  }\r\n  if (isNull(props.isBounded)) {\r\n    state.bounded = layout.isBounded\r\n  } else {\r\n    state.bounded = props.isBounded\r\n  }\r\n  state.transformScale = layout.transformScale\r\n  state.useCssTransforms = layout.useCssTransforms\r\n  state.useStyleCursor = layout.useStyleCursor\r\n\r\n  watchEffect(() => {\r\n    innerX = props.x\r\n    innerY = props.y\r\n    innerH = props.h\r\n    innerW = props.w\r\n    nextTickOnce(createStyle)\r\n  })\r\n\r\n  emitter.on('updateWidth', updateWidthHandler)\r\n  emitter.on('compact', compactHandler)\r\n  emitter.on('setDraggable', setDraggableHandler)\r\n  emitter.on('setResizable', setResizableHandler)\r\n  emitter.on('setBounded', setBoundedHandler)\r\n  emitter.on('setTransformScale', setTransformScaleHandler)\r\n  emitter.on('setRowHeight', setRowHeightHandler)\r\n  emitter.on('setMaxRows', setMaxRowsHandler)\r\n  emitter.on('directionchange', directionchangeHandler)\r\n  emitter.on('setColNum', setColNum)\r\n})\r\n\r\n/**\r\n * onBeforeUnmount\r\n * 组件卸载前清理：\r\n * 1. 取消所有 emitter 事件监听，防止内存泄漏或卸载后仍触发逻辑。\r\n * 2. 解除 interact 实例（unset）释放其内部注册的事件与状态。\r\n * 3. 从父级布局注销当前项引用（layout.decreaseItem），确保后续布局计算不再包含此项。\r\n */\r\nonBeforeUnmount(() => {\r\n  emitter.off('updateWidth', updateWidthHandler)\r\n  emitter.off('compact', compactHandler)\r\n  emitter.off('setDraggable', setDraggableHandler)\r\n  emitter.off('setResizable', setResizableHandler)\r\n  emitter.off('setBounded', setBoundedHandler)\r\n  emitter.off('setTransformScale', setTransformScaleHandler)\r\n  emitter.off('setRowHeight', setRowHeightHandler)\r\n  emitter.off('setMaxRows', setMaxRowsHandler)\r\n  emitter.off('directionchange', directionchangeHandler)\r\n  emitter.off('setColNum', setColNum)\r\n\r\n  if (interactObj.value) {\r\n    interactObj.value.unset()\r\n    interactObj.value = null\r\n  }\r\n\r\n  layout.decreaseItem(instance)\r\n})\r\n\r\ndefineExpose({ state, wrapper })\r\n\r\nconst isAndroid =\r\n  typeof navigator !== 'undefined' ? navigator.userAgent.toLowerCase().includes('android') : false\r\n\r\nconst resizableAndNotStatic = computed(() => state.resizable && !props.static) // 是否显示缩放手柄\r\nconst renderRtl = computed(() => (layout.isMirrored ? !state.rtl : state.rtl)) // 结合镜像与文档方向得到最终渲染方向\r\nconst draggableOrResizableAndNotStatic = computed(() => {\r\n  return (state.draggable || state.resizable) && !props.static // 是否存在任一交互能力且非静态\r\n})\r\n\r\nconst nh = useNameHelper('item')\r\n\r\nconst className = computed(() => {\r\n  return {\r\n    [nh.b()]: true,\r\n    [nh.bm('resizable')]: resizableAndNotStatic.value, // 可缩放\r\n    [nh.bm('static')]: props.static, // 静态锁定\r\n    [nh.bm('resizing')]: state.isResizing, // 缩放中\r\n    [nh.bm('dragging')]: state.isDragging, // 拖拽中\r\n    [nh.bm('transform')]: state.useCssTransforms, // 使用 transform 布局模式\r\n    [nh.bm('rtl')]: renderRtl.value, // RTL 渲染修饰\r\n    [nh.bm('no-touch')]: isAndroid && draggableOrResizableAndNotStatic.value, // Android 下禁用触摸样式修饰\r\n  }\r\n})\r\nconst resizerClass = computed(() => {\r\n  // return renderRtl.value ? 'vue-resizable-handle vue-rtl-resizable-handle' : 'vue-resizable-handle'\r\n  return [nh.be('resizer'), renderRtl.value && nh.bem('resizer', 'rtl')].filter(Boolean)\r\n})\r\n\r\n// 智能检测：若用户在 resizeOption 中自定义了 edges（任意形式），则认为使用“边缘/自定义手柄”模式，隐藏默认单一手柄 span\r\nconst userCustomEdges = computed(() => {\r\n  const opt = props.resizeOption as any\r\n  if (!opt) return false\r\n  const edges = opt.edges\r\n  if (!edges) return false\r\n  // 任意存在即视为自定义（支持 boolean | object | selector 写法）\r\n  return true\r\n})\r\n// 当未自定义 edges 且组件允许缩放且非 static 时才展示默认手柄\r\nconst showResizer = computed(() => resizableAndNotStatic.value && !userCustomEdges.value)\r\n\r\n// 监听外部 isDraggable 变更 -> 直接覆盖内部 draggable 状态，后续由 tryMakeDraggable 根根据新值重新配置\r\nwatch(\r\n  () => props.isDraggable,\r\n  value => {\r\n    state.draggable = value\r\n  },\r\n) \r\n// 监听 static 切换 -> 重新尝试创建/禁用拖拽与缩放（静态时两者均禁用）\r\nwatch(\r\n  () => props.static,\r\n  () => {\r\n    nextTickOnce(tryMakeDraggable)\r\n    nextTickOnce(tryMakeResizable)\r\n  },\r\n) \r\n// 监听内部 draggable 状态变化 -> 延迟到下一个 tick 重建拖拽实例配置（避免在同一同步周期反复初始化）\r\nwatch(\r\n  () => state.draggable,\r\n  () => {\r\n    nextTickOnce(tryMakeDraggable)\r\n  },\r\n) \r\n// 监听外部 isResizable 变更 -> 直接同步到内部 resizable，随后由对应 watcher 触发重建缩放实例\r\nwatch(\r\n  () => props.isResizable,\r\n  value => {\r\n    state.resizable = value\r\n  },\r\n) \r\n// 监听外部 isBounded 变更 -> 更新是否启用受限拖拽，影响 dragmove 时 clamp 边界裁剪\r\nwatch(\r\n  () => props.isBounded,\r\n  value => {\r\n    state.bounded = value\r\n  },\r\n) \r\n// 监听内部 resizable 状态变化 -> 下一个 tick 重建缩放配置（边缘、约束、光标等）\r\nwatch(\r\n  () => state.resizable,\r\n  () => {\r\n    nextTickOnce(tryMakeResizable)\r\n  },\r\n) \r\n// 监听行高变化 -> 重算定位与尺寸并向外派发容器实际像素尺寸更新\r\nwatch(\r\n  () => state.rowHeight,\r\n  () => {\r\n    nextTickOnce(createStyle)\r\n    nextTickOnce(emitContainerResized)\r\n  },\r\n) \r\n// 监听列数或容器宽度变化 -> 影响单列宽度与像素换算，需更新样式与缩放约束并通知尺寸变化\r\nwatch([() => state.cols, () => state.containerWidth], () => {\r\n  nextTickOnce(tryMakeResizable)\r\n  nextTickOnce(createStyle)\r\n  nextTickOnce(emitContainerResized)\r\n}) \r\n// 监听最小/最大行列限制变化 -> 重建缩放时的 restrictSize 约束\r\nwatch([() => props.minH, () => props.maxH, () => props.minW, () => props.maxW], () => {\r\n  nextTickOnce(tryMakeResizable)\r\n}) \r\n// 监听渲染方向 (RTL + mirrored) 变化 -> 需调整缩放边缘、拖拽/定位计算方式与最终样式\r\nwatch(renderRtl, () => {\r\n  nextTickOnce(tryMakeResizable)\r\n  nextTickOnce(createStyle)\r\n}) \r\n// 监听父布局 margin 变化（含整体或单值） -> 更新内部 margin 并重算样式与尺寸回调\r\nwatch([() => layout.margin, () => layout.margin[0], () => layout.margin[1]], () => {\r\n  const margin = layout.margin\r\n\r\n  if (!margin || (margin[0] === state.margin[0] && margin[1] === state.margin[1])) {\r\n    return\r\n  }\r\n\r\n  state.margin = margin.map(Number)\r\n  nextTickOnce(createStyle)\r\n  nextTickOnce(emitContainerResized)\r\n}) \r\n\r\n/**\r\n * createStyle\r\n * 根据内部记录的网格坐标与交互临时状态生成最终内联样式（位置 + 尺寸）。\r\n * 逻辑：\r\n * 1. 若当前 w 超出列数，裁剪并重设 innerX/innerW。\r\n * 2. 基础样式使用 calcPosition 计算（网格单位 -> 像素）。\r\n * 3. 若正在拖拽/缩放，优先使用临时的 dragging/resizing 像素值覆盖。\r\n * 4. 根据 useCssTransforms 决定采用 transform 还是 top/left 定位；RTL 下切换为 right。\r\n * @returns void\r\n */\r\nfunction createStyle() {\r\n  if (props.x + props.w > state.cols) {\r\n    innerX = 0\r\n    innerW = props.w > state.cols ? state.cols : props.w\r\n  } else {\r\n    innerX = props.x\r\n    innerW = props.w\r\n  }\r\n\r\n  const pos = calcPosition(innerX, innerY, innerW, innerH)\r\n\r\n  if (state.isDragging) {\r\n    pos.top = state.dragging.top\r\n    // Add rtl support\r\n    if (renderRtl.value) {\r\n      pos.right = state.dragging.left\r\n    } else {\r\n      pos.left = state.dragging.left\r\n    }\r\n  }\r\n  if (state.isResizing) {\r\n    pos.width = state.resizing.width\r\n    pos.height = state.resizing.height\r\n  }\r\n\r\n  let style\r\n  // CSS Transforms support (default)\r\n  if (state.useCssTransforms) {\r\n    // Add rtl support\r\n    if (renderRtl.value) {\r\n      style = setTransformRtl(pos.top, pos.right!, pos.width, pos.height)\r\n    } else {\r\n      style = setTransform(pos.top, pos.left!, pos.width, pos.height)\r\n    }\r\n  } else {\r\n    // top,left (slow)\r\n    // Add rtl support\r\n    if (renderRtl.value) {\r\n      style = setTopRight(pos.top, pos.right!, pos.width, pos.height)\r\n    } else {\r\n      style = setTopLeft(pos.top, pos.left!, pos.width, pos.height)\r\n    }\r\n  }\r\n\r\n  state.style = style\r\n}\r\n\r\n/**\r\n * emitContainerResized\r\n * 派发当前组件的像素宽高（去掉单位 px），便于外部监听容器内部真实渲染尺寸变化。\r\n */\r\nfunction emitContainerResized() {\r\n  // this.style has width and height with trailing 'px'. The\r\n  // resized event is without them\r\n  const styleProps: Record<string, string> = {}\r\n  for (const prop of ['width', 'height']) {\r\n    const val = state.style[prop]\r\n    const matches = val.match(/^(\\d+)px$/)\r\n    if (!matches) {\r\n      return\r\n    }\r\n    styleProps[prop] = matches[1]\r\n  }\r\n  emit('container-resized', props.i, props.h, props.w, styleProps.height, styleProps.width)\r\n}\r\n\r\n/**\r\n * handleResize\r\n * 处理缩放生命周期事件。\r\n * @param event interact 回调事件对象（含 edges）\r\n */\r\nfunction handleResize(event: MouseEvent & { edges: any }) {\r\n  if (props.static) return\r\n\r\n  const type = event.type\r\n  if (\r\n    (type === 'resizestart' && state.isResizing) ||\r\n    (type !== 'resizestart' && !state.isResizing)\r\n  ) {\r\n    return\r\n  }\r\n\r\n  const position = getControlPosition(event)\r\n  // Get the current drag point from the event. This is used as the offset.\r\n  if (isNull(position)) return // not possible but satisfies flow\r\n\r\n  const { x, y } = position\r\n  const newSize = { width: 0, height: 0 }\r\n  let pos\r\n  // 新增：根据事件携带的 edges 标记当前活动缩放边\r\n  if (event.edges) {\r\n    state.activeResizeEdges.top = !!event.edges.top\r\n    state.activeResizeEdges.right = !!event.edges.right\r\n    state.activeResizeEdges.bottom = !!event.edges.bottom\r\n    state.activeResizeEdges.left = !!event.edges.left\r\n  }\r\n  switch (type) {\r\n    case 'resizestart': {\r\n      tryMakeResizable()\r\n      previousW = innerW\r\n      previousH = innerH\r\n      pos = calcPosition(innerX, innerY, innerW, innerH)\r\n      newSize.width = pos.width\r\n      newSize.height = pos.height\r\n      state.resizing = newSize\r\n      state.isResizing = true\r\n      break\r\n    }\r\n    case 'resizemove': {\r\n      // A vertical resize ignores the horizontal delta\r\n      if (!event.edges.right && !event.edges.left) {\r\n        lastW = x\r\n      }\r\n\r\n      // An horizontal resize ignores the vertical delta\r\n      if (!event.edges.top && !event.edges.bottom) {\r\n        lastH = y\r\n      }\r\n\r\n      const coreEvent = createCoreData(lastW, lastH, x, y)\r\n      if (renderRtl.value) {\r\n        newSize.width = state.resizing.width - coreEvent.deltaX / state.transformScale\r\n      } else {\r\n        newSize.width = state.resizing.width + coreEvent.deltaX / state.transformScale\r\n      }\r\n      newSize.height = state.resizing.height + coreEvent.deltaY / state.transformScale\r\n      state.resizing = newSize\r\n      break\r\n    }\r\n    case 'resizeend': {\r\n      pos = calcPosition(innerX, innerY, innerW, innerH)\r\n      newSize.width = pos.width\r\n      newSize.height = pos.height\r\n\r\n      state.resizing = { width: -1, height: -1 }\r\n      state.isResizing = false\r\n      // 清理活动边高亮\r\n      state.activeResizeEdges.top = false\r\n      state.activeResizeEdges.right = false\r\n      state.activeResizeEdges.bottom = false\r\n      state.activeResizeEdges.left = false\r\n      break\r\n    }\r\n  }\r\n\r\n  // Get new WH\r\n  pos = calcWH(newSize.height, newSize.width)\r\n  if (pos.w < props.minW) {\r\n    pos.w = props.minW\r\n  }\r\n  if (pos.w > props.maxW) {\r\n    pos.w = props.maxW\r\n  }\r\n  if (pos.h < props.minH) {\r\n    pos.h = props.minH\r\n  }\r\n  if (pos.h > props.maxH) {\r\n    pos.h = props.maxH\r\n  }\r\n\r\n  if (pos.h < 1) {\r\n    pos.h = 1\r\n  }\r\n  if (pos.w < 1) {\r\n    pos.w = 1\r\n  }\r\n\r\n  lastW = x\r\n  lastH = y\r\n\r\n  if (innerW !== pos.w || innerH !== pos.h) {\r\n    emit('resize', props.i, pos.h, pos.w, newSize.height, newSize.width)\r\n  }\r\n  if (event.type === 'resizeend' && (previousW !== innerW || previousH !== innerH)) {\r\n    emit('resized', props.i, pos.h, pos.w, newSize.height, newSize.width)\r\n  }\r\n  emitter.emit('resizeEvent', event.type, props.i, innerX, innerY, pos.h, pos.w)\r\n}\r\n\r\n/**\r\n * handleDrag\r\n * 处理拖拽生命周期事件。\r\n * @param event 鼠标/触控事件\r\n */\r\nfunction handleDrag(event: MouseEvent) {\r\n  if (props.static || state.isResizing) return\r\n\r\n  const type = event.type\r\n  if ((type === 'dragstart' && state.isDragging) || (type !== 'dragstart' && !state.isDragging)) {\r\n    return\r\n  }\r\n\r\n  const position = getControlPosition(event)\r\n\r\n  // Get the current drag point from the event. This is used as the offset.\r\n  if (isNull(position)) return // not possible but satisfies flow\r\n  const { x, y } = position\r\n  const target = event.target as HTMLElement\r\n\r\n  if (!target.offsetParent) return\r\n\r\n  // let shouldUpdate = false;\r\n  const newPosition = { top: 0, left: 0 }\r\n  switch (type) {\r\n    case 'dragstart': {\r\n      previousX = innerX\r\n      previousY = innerY\r\n\r\n      const parentRect = target.offsetParent.getBoundingClientRect()\r\n      const clientRect = target.getBoundingClientRect()\r\n\r\n      const cLeft = clientRect.left / state.transformScale\r\n      const pLeft = parentRect.left / state.transformScale\r\n      const cRight = clientRect.right / state.transformScale\r\n      const pRight = parentRect.right / state.transformScale\r\n      const cTop = clientRect.top / state.transformScale\r\n      const pTop = parentRect.top / state.transformScale\r\n\r\n      if (renderRtl.value) {\r\n        newPosition.left = (cRight - pRight) * -1\r\n      } else {\r\n        newPosition.left = cLeft - pLeft\r\n      }\r\n      newPosition.top = cTop - pTop\r\n      state.dragging = newPosition\r\n      state.isDragging = true\r\n      break\r\n    }\r\n    case 'dragmove': {\r\n      const coreEvent = createCoreData(lastX, lastY, x, y)\r\n      // Add rtl support\r\n      if (renderRtl.value) {\r\n        newPosition.left = state.dragging.left - coreEvent.deltaX / state.transformScale\r\n      } else {\r\n        newPosition.left = state.dragging.left + coreEvent.deltaX / state.transformScale\r\n      }\r\n      newPosition.top = state.dragging.top + coreEvent.deltaY / state.transformScale\r\n      if (state.bounded) {\r\n        const bottomBoundary =\r\n          target.offsetParent.clientHeight -\r\n          calcGridItemWHPx(props.h, state.rowHeight, state.margin[1])\r\n        newPosition.top = clamp(newPosition.top, 0, bottomBoundary)\r\n        const colWidth = calcColWidth()\r\n        const rightBoundary =\r\n          state.containerWidth - calcGridItemWHPx(props.w, colWidth, state.margin[0])\r\n        newPosition.left = clamp(newPosition.left, 0, rightBoundary)\r\n      }\r\n\r\n      state.dragging = newPosition\r\n      break\r\n    }\r\n    case 'dragend': {\r\n      const parentRect = target.offsetParent.getBoundingClientRect()\r\n      const clientRect = target.getBoundingClientRect()\r\n\r\n      const cLeft = clientRect.left / state.transformScale\r\n      const pLeft = parentRect.left / state.transformScale\r\n      const cRight = clientRect.right / state.transformScale\r\n      const pRight = parentRect.right / state.transformScale\r\n      const cTop = clientRect.top / state.transformScale\r\n      const pTop = parentRect.top / state.transformScale\r\n\r\n      // Add rtl support\r\n      if (renderRtl.value) {\r\n        newPosition.left = (cRight - pRight) * -1\r\n      } else {\r\n        newPosition.left = cLeft - pLeft\r\n      }\r\n      newPosition.top = cTop - pTop\r\n      state.dragging = { top: -1, left: -1 }\r\n      state.isDragging = false\r\n      break\r\n    }\r\n  }\r\n\r\n  // Get new XY\r\n  let pos\r\n  if (renderRtl.value) {\r\n    pos = calcXY(newPosition.top, newPosition.left)\r\n  } else {\r\n    pos = calcXY(newPosition.top, newPosition.left)\r\n  }\r\n\r\n  lastX = x\r\n  lastY = y\r\n\r\n  if (innerX !== pos.x || innerY !== pos.y) {\r\n    emit('move', props.i, pos.x, pos.y)\r\n  }\r\n  if (event.type === 'dragend' && (previousX !== innerX || previousY !== innerY)) {\r\n    emit('moved', props.i, pos.x, pos.y)\r\n  }\r\n  emitter.emit('dragEvent', event.type, props.i, pos.x, pos.y, innerH, innerW)\r\n}\r\n\r\n/**\r\n * calcPosition\r\n * 网格单位转像素坐标和尺寸。\r\n * @param x 列起点\r\n * @param y 行起点\r\n * @param w 宽度(列数)\r\n * @param h 高度(行数)\r\n * @returns 像素定位与宽高对象\r\n */\r\nfunction calcPosition(x: number, y: number, w: number, h: number) {\r\n  const colWidth = calcColWidth()\r\n  // add rtl support\r\n  let out\r\n  if (renderRtl.value) {\r\n    out = {\r\n      right: Math.round(colWidth * x + (x + 1) * state.margin[0]),\r\n      top: Math.round(state.rowHeight * y + (y + 1) * state.margin[1]),\r\n      // 0 * Infinity === NaN, which causes problems with resize constraints;\r\n      // Fix this if it occurs.\r\n      // Note we do it here rather than later because Math.round(Infinity) causes depot\r\n      width: w === Infinity ? w : Math.round(colWidth * w + Math.max(0, w - 1) * state.margin[0]),\r\n      height:\r\n        h === Infinity ? h : Math.round(state.rowHeight * h + Math.max(0, h - 1) * state.margin[1]),\r\n    }\r\n  } else {\r\n    out = {\r\n      left: Math.round(colWidth * x + (x + 1) * state.margin[0]),\r\n      top: Math.round(state.rowHeight * y + (y + 1) * state.margin[1]),\r\n      // 0 * Infinity === NaN, which causes problems with resize constraints;\r\n      // Fix this if it occurs.\r\n      // Note we do it here rather than later because Math.round(Infinity) causes depot\r\n      width: w === Infinity ? w : Math.round(colWidth * w + Math.max(0, w - 1) * state.margin[0]),\r\n      height:\r\n        h === Infinity ? h : Math.round(state.rowHeight * h + Math.max(0, h - 1) * state.margin[1]),\r\n    }\r\n  }\r\n\r\n  return out\r\n}\r\n\r\n/**\r\n * Translate x and y coordinates from pixels to grid units.\r\n * @param top  Top position (relative to parent) in pixels.\r\n * @param left Left position (relative to parent) in pixels.\r\n * @return x and y in grid units.\r\n */\r\n// TODO check if this function needs change in order to support rtl.\r\nfunction calcXY(top: number, left: number) {\r\n  const colWidth = calcColWidth()\r\n\r\n  // left = colWidth * x + margin * (x + 1)\r\n  // l = cx + m(x+1)\r\n  // l = cx + mx + m\r\n  // l - m = cx + mx\r\n  // l - m = x(c + m)\r\n  // (l - m) / (c + m) = x\r\n  // x = (left - margin) / (coldWidth + margin)\r\n  let x = Math.round((left - state.margin[0]) / (colWidth + state.margin[0]))\r\n  let y = Math.round((top - state.margin[1]) / (state.rowHeight + state.margin[1]))\r\n\r\n  // Capping\r\n  x = Math.max(Math.min(x, state.cols - innerW), 0)\r\n  y = Math.max(Math.min(y, state.maxRows - innerH), 0)\r\n\r\n  return { x, y }\r\n}\r\n\r\n/**\r\n * 计算单列像素宽度。\r\n * @returns 单列宽度\r\n */\r\nfunction calcColWidth() {\r\n  return (state.containerWidth - state.margin[0] * (state.cols + 1)) / state.cols\r\n}\r\n\r\n/**\r\n * 网格单位转换为像素尺寸。\r\n * @param gridUnits 行或列的跨度\r\n * @param colOrRowSize 单列或单行的像素尺寸\r\n * @param marginPx 对应方向的间距像素\r\n * @returns 像素尺寸\r\n */\r\nfunction calcGridItemWHPx(gridUnits: number, colOrRowSize: number, marginPx: number) {\r\n  // 0 * Infinity === NaN, which causes problems with resize constraints\r\n  if (!Number.isFinite(gridUnits)) return gridUnits\r\n  return Math.round(colOrRowSize * gridUnits + Math.max(0, gridUnits - 1) * marginPx)\r\n}\r\n\r\n/**\r\n * 约束数值在指定区间。\r\n * @param num 原始值\r\n * @param lowerBound 下界\r\n * @param upperBound 上界\r\n * @returns 约束后的值\r\n */\r\nfunction clamp(num: number, lowerBound: number, upperBound: number) {\r\n  return Math.max(Math.min(num, upperBound), lowerBound)\r\n}\r\n\r\n/**\r\n * 像素宽高转换为网格单位。\r\n * @param height 像素高度\r\n * @param width 像素宽度\r\n * @param autoSizeFlag 高度是否向上取整标记\r\n * @returns {w,h}\r\n */\r\nfunction calcWH(height: number, width: number, autoSizeFlag = false) {\r\n  const colWidth = calcColWidth()\r\n\r\n  // width = colWidth * w - (margin * (w - 1))\r\n  // ...\r\n  // w = (width + margin) / (colWidth + margin)\r\n  let w = Math.round((width + state.margin[0]) / (colWidth + state.margin[0]))\r\n  let h = 0\r\n  if (!autoSizeFlag) {\r\n    h = Math.round((height + state.margin[1]) / (state.rowHeight + state.margin[1]))\r\n  } else {\r\n    h = Math.ceil((height + state.margin[1]) / (state.rowHeight + state.margin[1]))\r\n  }\r\n\r\n  // Capping\r\n  w = Math.max(Math.min(w, state.cols - innerX), 0)\r\n  h = Math.max(Math.min(h, state.maxRows - innerY), 0)\r\n  return { w, h }\r\n}\r\n\r\n/**\r\n * updateWidth\r\n * 更新容器宽度及可选列数。\r\n * @param width 新容器宽度\r\n * @param colNum 可选新列数\r\n */\r\nfunction updateWidth(width: number, colNum?: number) {\r\n  state.containerWidth = width\r\n  if (colNum !== undefined && colNum !== null) {\r\n    state.cols = colNum\r\n  }\r\n}\r\n\r\n/**\r\n * compact\r\n * 执行样式重算（一般在父级压缩或外部触发时）。\r\n */\r\nfunction compact() {\r\n  createStyle()\r\n}\r\n\r\n/**\r\n * tryInteract\r\n * 初始化 interact 实例（避免重复）。\r\n */\r\nfunction tryInteract() {\r\n  if (!interactObj.value && wrapper.value) {\r\n    interactObj.value = interact(wrapper.value)\r\n    if (!state.useStyleCursor) {\r\n      interactObj.value.styleCursor(false)\r\n    }\r\n  }\r\n}\r\n\r\nconst throttleDrag = throttle(handleDrag)\r\n\r\n/**\r\n * tryMakeDraggable\r\n * 配置拖拽行为与事件监听，或在不满足条件时禁用。\r\n */\r\nfunction tryMakeDraggable() {\r\n  tryInteract()\r\n\r\n  if (!interactObj.value) return\r\n\r\n  if (state.draggable && !props.static) {\r\n    const opts = {\r\n      ignoreFrom: props.dragIgnoreFrom,\r\n      allowFrom: props.dragAllowFrom,\r\n      ...props.dragOption,\r\n    }\r\n    interactObj.value.draggable(opts)\r\n\r\n    if (!dragEventSet) {\r\n      dragEventSet = true\r\n      interactObj.value.on('dragstart dragmove dragend', event => {\r\n        event.type === 'dragmove' ? throttleDrag(event) : handleDrag(event)\r\n      })\r\n    }\r\n  } else {\r\n    interactObj.value.draggable({ enabled: false })\r\n  }\r\n}\r\n\r\nconst throttleResize = throttle(handleResize)\r\n\r\n/**\r\n * tryMakeResizable\r\n * 配置缩放行为与事件监听，计算并传入尺寸约束。\r\n */\r\nfunction tryMakeResizable() {\r\n  tryInteract()\r\n\r\n  if (!interactObj.value) return\r\n\r\n  if (state.resizable && !props.static) {\r\n    const maximum = calcPosition(0, 0, props.maxW, props.maxH)\r\n    const minimum = calcPosition(0, 0, props.minW, props.minH)\r\n\r\n    const opts: Record<string, any> = {\r\n      edges: {\r\n        left: renderRtl.value ? `.${resizerClass.value[0]}` : false,\r\n        right: !renderRtl.value ? `.${resizerClass.value[0]}` : false,\r\n        bottom: `.${resizerClass.value[0]}`,\r\n        top: false,\r\n      },\r\n      ignoreFrom: props.resizeIgnoreFrom,\r\n      restrictSize: {\r\n        min: {\r\n          height: minimum.height * state.transformScale,\r\n          width: minimum.width * state.transformScale,\r\n        },\r\n        max: {\r\n          height: maximum.height * state.transformScale,\r\n          width: maximum.width * state.transformScale,\r\n        },\r\n      },\r\n      ...props.resizeOption,\r\n    }\r\n\r\n    if (props.preserveAspectRatio) {\r\n      opts.modifiers = [interact.modifiers.aspectRatio({ ratio: 'preserve' })]\r\n    }\r\n\r\n    interactObj.value.resizable(opts)\r\n    // 新增：记录哪些边是启用的，供模板渲染和 hover 高亮\r\n    const ec: any = opts.edges || {}\r\n    state.enabledResizeEdges.top = !!ec.top\r\n    state.enabledResizeEdges.right = !!ec.right\r\n    state.enabledResizeEdges.bottom = !!ec.bottom\r\n    state.enabledResizeEdges.left = !!ec.left\r\n    if (!resizeEventSet) {\r\n      resizeEventSet = true\r\n      interactObj.value.on('resizestart resizemove resizeend', event => {\r\n        event.type === 'resizemove' ? throttleResize(event) : handleResize(event)\r\n      })\r\n    }\r\n  } else {\r\n    interactObj.value.resizable({ enabled: false })\r\n    state.enabledResizeEdges.top = false\r\n    state.enabledResizeEdges.right = false\r\n    state.enabledResizeEdges.bottom = false\r\n    state.enabledResizeEdges.left = false\r\n  }\r\n}\r\n</script>\r\n\r\n<template>\r\n  <section ref=\"wrapper\" :class=\"className\" :style=\"state.style\">\r\n    <slot></slot>\r\n    <span v-if=\"showResizer\" :class=\"resizerClass\"></span>\r\n    <!-- 改造：始终渲染边框元素（只在启用边时可 hover），缩放中额外用 is-active 表示当前操作边 -->\r\n    <div\r\n      v-if=\"resizableAndNotStatic\"\r\n      class=\"vgl-item__edge vgl-item__edge--top\"\r\n      :class=\"[{ 'is-enabled': state.enabledResizeEdges.top, 'is-active': state.activeResizeEdges.top }]\r\n      \"\r\n      aria-hidden=\"true\"\r\n    ></div>\r\n    <div\r\n      v-if=\"resizableAndNotStatic\"\r\n      class=\"vgl-item__edge vgl-item__edge--right\"\r\n      :class=\"[{ 'is-enabled': state.enabledResizeEdges.right, 'is-active': state.activeResizeEdges.right }]\r\n      \"\r\n      aria-hidden=\"true\"\r\n    ></div>\r\n    <div\r\n      v-if=\"resizableAndNotStatic\"\r\n      class=\"vgl-item__edge vgl-item__edge--bottom\"\r\n      :class=\"[{ 'is-enabled': state.enabledResizeEdges.bottom, 'is-active': state.activeResizeEdges.bottom }]\r\n      \"\r\n      aria-hidden=\"true\"\r\n    ></div>\r\n    <div\r\n      v-if=\"resizableAndNotStatic\"\r\n      class=\"vgl-item__edge vgl-item__edge--left\"\r\n      :class=\"[{ 'is-enabled': state.enabledResizeEdges.left, 'is-active': state.activeResizeEdges.left }]\r\n      \"\r\n      aria-hidden=\"true\"\r\n    ></div>\r\n  </section>\r\n</template>\r\n"],"names":["props","__props","emit","__emit","layout","inject","LAYOUT_KEY","emitter","EMITTER_KEY","interactObj","shallowRef","state","reactive","dragEventSet","resizeEventSet","lastX","lastY","lastW","lastH","previousW","previousH","previousX","previousY","innerX","innerY","innerW","innerH","wrapper","ref","instance","toRef","calcXY","updateWidthHandler","width","updateWidth","compactHandler","compact","setDraggableHandler","isDraggable","isNull","setResizableHandler","isResizable","setBoundedHandler","isBounded","setTransformScaleHandler","transformScale","setRowHeightHandler","rowHeight","setMaxRowsHandler","maxRows","directionchangeHandler","getDocumentDir","setColNum","colNum","onBeforeMount","onMounted","getColsFromBreakpoint","watchEffect","nextTickOnce","createStyle","onBeforeUnmount","__expose","isAndroid","resizableAndNotStatic","computed","renderRtl","draggableOrResizableAndNotStatic","nh","useNameHelper","className","resizerClass","userCustomEdges","opt","showResizer","watch","value","tryMakeDraggable","tryMakeResizable","emitContainerResized","margin","pos","calcPosition","style","setTransformRtl","setTransform","setTopRight","setTopLeft","styleProps","prop","matches","handleResize","event","type","position","getControlPosition","x","y","newSize","coreEvent","createCoreData","calcWH","handleDrag","target","newPosition","parentRect","clientRect","cLeft","pLeft","cRight","pRight","cTop","pTop","bottomBoundary","calcGridItemWHPx","clamp","colWidth","calcColWidth","rightBoundary","w","h","out","top","left","gridUnits","colOrRowSize","marginPx","num","lowerBound","upperBound","height","autoSizeFlag","tryInteract","interact","throttleDrag","throttle","opts","throttleResize","maximum","minimum","ec"],"mappings":"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"}