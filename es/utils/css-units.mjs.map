{"version":3,"file":"css-units.mjs","sources":["../../src/utils/css-units.ts"],"sourcesContent":["// 通用 CSS 单位解析工具方法抽离\r\n// 提供: isCssUnitValue, parseCssSize, parsePositionValue\r\n// 统一在交互与包装组件中使用, 避免重复逻辑\r\n\r\nexport const isCssUnitValue = (val: unknown): val is string => typeof val === 'string' && /(px|%|vw|vh|rem|em|calc\\(|ch|ex)/i.test(val || '')\r\n\r\n/**\r\n * 解析尺寸值(宽/高)为像素\r\n * @param size 要解析的尺寸值, 支持 number | string (px,% ,vw,vh,rem,em,calc,ch,ex)\r\n * @param element 关联元素, 用于 % / em / calc 降级测量\r\n * @param direction width|height 用于 % 基准选择\r\n */\r\nexport function parseCssSize(\r\n  size: number | string,\r\n  element: HTMLElement | SVGElement | null | undefined,\r\n  direction: 'width' | 'height' = 'width',\r\n): number {\r\n  if (typeof size === 'number') return size\r\n  if (typeof size !== 'string' || !size) return 0\r\n\r\n  const raw = size.trim()\r\n  // 纯数字\r\n  if (/^[-+]?[0-9]*\\.?[0-9]+$/.test(raw)) return parseFloat(raw)\r\n  // px\r\n  if (/px$/i.test(raw)) return parseFloat(raw)\r\n  // vh / vw\r\n  if (/vh$/i.test(raw)) { const v = parseFloat(raw); return isNaN(v) ? 0 : window.innerHeight * v / 100 }\r\n  if (/vw$/i.test(raw)) { const v = parseFloat(raw); return isNaN(v) ? 0 : window.innerWidth * v / 100 }\r\n  // rem\r\n  if (/rem$/i.test(raw)) { const v = parseFloat(raw); const rootSize = parseFloat(getComputedStyle(document.documentElement).fontSize) || 16; return rootSize * v }\r\n  // em\r\n  if (/em$/i.test(raw)) {\r\n    const v = parseFloat(raw)\r\n    const selfSize = element instanceof HTMLElement\r\n      ? parseFloat(getComputedStyle(element).fontSize)\r\n      : parseFloat(getComputedStyle(document.documentElement).fontSize)\r\n    return (selfSize || 16) * v\r\n  }\r\n  // 百分比 (需要父元素)\r\n  if (/%$/i.test(raw)) {\r\n    const v = parseFloat(raw)\r\n    const parent = element instanceof HTMLElement ? element.parentElement : null\r\n    if (!parent || isNaN(v)) return 0\r\n    const rect = parent.getBoundingClientRect()\r\n    const base = direction === 'width' ? rect.width : rect.height\r\n    return base * v / 100\r\n  }\r\n  // calc(...) 及其它复杂表达式降级测量\r\n  if (/calc\\(/i.test(raw) || /(ch|ex)$/i.test(raw) || isCssUnitValue(raw)) {\r\n    return measureFallback(raw, element, direction)\r\n  }\r\n  // 未匹配则返回0\r\n  return 0\r\n}\r\n\r\nfunction measureFallback(raw: string, element: HTMLElement | SVGElement | null | undefined, direction: 'width' | 'height'): number {\r\n  const temp = document.createElement('div')\r\n  temp.style.position = 'absolute'\r\n  temp.style.visibility = 'hidden'\r\n  temp.style.pointerEvents = 'none'\r\n  temp.style.margin = '0'\r\n  temp.style.padding = '0'\r\n  temp.style.border = '0'\r\n  temp.style.boxSizing = 'border-box'\r\n  if (direction === 'width') temp.style.width = raw; else temp.style.height = raw\r\n  const container = (element instanceof HTMLElement && element.parentElement) || document.body\r\n  container.appendChild(temp)\r\n  const pixels = parseFloat(getComputedStyle(temp)[direction])\r\n  temp.remove()\r\n  return isNaN(pixels) ? 0 : pixels\r\n}\r\n\r\n/**\r\n * 解析位置值 (x/y) 为像素, x 使用 width 语义, y 使用 height 语义\r\n */\r\nexport function parsePositionValue(\r\n  value: number | string,\r\n  element: HTMLElement | SVGElement | null | undefined,\r\n  axis: 'x' | 'y',\r\n): number {\r\n  if (typeof value === 'number') return value\r\n  if (!isCssUnitValue(value)) return parseFloat(value) || 0\r\n  return parseCssSize(value, element, axis === 'x' ? 'width' : 'height')\r\n}\r\n"],"names":["isCssUnitValue","val","parseCssSize","size","element","direction","raw","v","parent","rect","measureFallback","temp","pixels","parsePositionValue","value","axis"],"mappings":"AAIa,MAAAA,IAAiB,CAACC,MAAgC,OAAOA,KAAQ,YAAY,oCAAoC,KAAKA,KAAO,EAAE;AAQrI,SAASC,EACdC,GACAC,GACAC,IAAgC,SACxB;AACJ,MAAA,OAAOF,KAAS,SAAiB,QAAAA;AACrC,MAAI,OAAOA,KAAS,YAAY,CAACA,EAAa,QAAA;AAExC,QAAAG,IAAMH,EAAK,KAAK;AAItB,MAFI,yBAAyB,KAAKG,CAAG,KAEjC,OAAO,KAAKA,CAAG,EAAG,QAAO,WAAWA,CAAG;AAEvC,MAAA,OAAO,KAAKA,CAAG,GAAG;AAAQ,UAAAC,IAAI,WAAWD,CAAG;AAAG,WAAO,MAAMC,CAAC,IAAI,IAAI,OAAO,cAAcA,IAAI;AAAA,EAAA;AAC9F,MAAA,OAAO,KAAKD,CAAG,GAAG;AAAQ,UAAAC,IAAI,WAAWD,CAAG;AAAG,WAAO,MAAMC,CAAC,IAAI,IAAI,OAAO,aAAaA,IAAI;AAAA,EAAA;AAE7F,MAAA,QAAQ,KAAKD,CAAG,GAAG;AAAQ,UAAAC,IAAI,WAAWD,CAAG;AAA2F,YAAvE,WAAW,iBAAiB,SAAS,eAAe,EAAE,QAAQ,KAAK,MAAsBC;AAAA,EAAA;AAE1J,MAAA,OAAO,KAAKD,CAAG,GAAG;AACd,UAAAC,IAAI,WAAWD,CAAG;AAIxB,aAHiBF,aAAmB,cAChC,WAAW,iBAAiBA,CAAO,EAAE,QAAQ,IAC7C,WAAW,iBAAiB,SAAS,eAAe,EAAE,QAAQ,MAC9C,MAAMG;AAAA,EAAA;AAGxB,MAAA,MAAM,KAAKD,CAAG,GAAG;AACb,UAAAC,IAAI,WAAWD,CAAG,GAClBE,IAASJ,aAAmB,cAAcA,EAAQ,gBAAgB;AACxE,QAAI,CAACI,KAAU,MAAMD,CAAC,EAAU,QAAA;AAC1B,UAAAE,IAAOD,EAAO,sBAAsB;AAE1C,YADaH,MAAc,UAAUI,EAAK,QAAQA,EAAK,UACzCF,IAAI;AAAA,EAAA;AAGhB,SAAA,UAAU,KAAKD,CAAG,KAAK,YAAY,KAAKA,CAAG,KAAKN,EAAeM,CAAG,IAC7DI,EAAgBJ,GAAKF,GAASC,CAAS,IAGzC;AACT;AAEA,SAASK,EAAgBJ,GAAaF,GAAsDC,GAAuC;AAC3H,QAAAM,IAAO,SAAS,cAAc,KAAK;AACzC,EAAAA,EAAK,MAAM,WAAW,YACtBA,EAAK,MAAM,aAAa,UACxBA,EAAK,MAAM,gBAAgB,QAC3BA,EAAK,MAAM,SAAS,KACpBA,EAAK,MAAM,UAAU,KACrBA,EAAK,MAAM,SAAS,KACpBA,EAAK,MAAM,YAAY,cACnBN,MAAc,UAAcM,EAAA,MAAM,QAAQL,IAAUK,EAAK,MAAM,SAASL,IACzDF,aAAmB,eAAeA,EAAQ,iBAAkB,SAAS,MAC9E,YAAYO,CAAI;AAC1B,QAAMC,IAAS,WAAW,iBAAiBD,CAAI,EAAEN,CAAS,CAAC;AAC3D,SAAAM,EAAK,OAAO,GACL,MAAMC,CAAM,IAAI,IAAIA;AAC7B;AAKgB,SAAAC,EACdC,GACAV,GACAW,GACQ;AACJ,SAAA,OAAOD,KAAU,WAAiBA,IACjCd,EAAec,CAAK,IAClBZ,EAAaY,GAAOV,GAASW,MAAS,MAAM,UAAU,QAAQ,IADlC,WAAWD,CAAK,KAAK;AAE1D;"}