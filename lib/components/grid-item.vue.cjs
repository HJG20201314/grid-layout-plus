"use strict";const a=require("vue"),g=require("@vexip-ui/utils"),y=require("../helpers/common.cjs"),D=require("../helpers/draggable.cjs"),Me=require("../helpers/responsive.cjs"),he=require("../helpers/dom.cjs"),pe=require("interactjs"),Be=a.defineComponent({__name:"grid-item",props:{isDraggable:{type:Boolean,default:void 0},isResizable:{type:Boolean,default:void 0},isBounded:{type:Boolean,default:void 0},static:{type:Boolean,default:!1},minH:{default:1},minW:{default:1},maxH:{default:1/0},maxW:{default:1/0},x:{},y:{},w:{},h:{},i:{},dragIgnoreFrom:{default:"a, button"},dragAllowFrom:{default:void 0},resizeIgnoreFrom:{default:"a, button"},preserveAspectRatio:{type:Boolean,default:!1},dragOption:{default:()=>({})},resizeOption:{default:()=>({})}},emits:["container-resized","resize","resized","move","moved"],setup(be,{expose:ze,emit:we}){const i=be,S=we,c=a.inject(y.LAYOUT_KEY),f=a.inject(y.EMITTER_KEY);if(!c)throw new Error("[grid-layout-plus]: missing layout store, GridItem must under a GridLayout.");const u=a.shallowRef(null),e=a.reactive({cols:1,containerWidth:100,rowHeight:30,margin:[10,10],maxRows:1/0,draggable:void 0,resizable:void 0,bounded:void 0,transformScale:1,useCssTransforms:!0,useStyleCursor:!0,isDragging:!1,dragging:{top:-1,left:-1},isResizing:!1,resizing:{width:-1,height:-1},style:{},rtl:!1,activeResizeEdges:{top:!1,right:!1,bottom:!1,left:!1},enabledResizeEdges:{top:!1,right:!1,bottom:!1,left:!1}});let X=!1,q=!1,V=NaN,$=NaN,_=NaN,O=NaN,j=-1,G=-1,K=-1,J=-1,p=i.x,v=i.y,b=i.w,R=i.h;const C=a.ref(),Q=a.reactive({i:a.toRef(i,"i"),state:e,wrapper:C,calcXY:F});function Z(t){He(t)}function U(){fe()}function ee(t){g.isNull(i.isDraggable)&&(e.draggable=t)}function te(t){g.isNull(i.isResizable)&&(e.resizable=t)}function ie(t){g.isNull(i.isBounded)&&(e.bounded=t)}function ae(t){e.transformScale=t}function se(t){e.rowHeight=t}function re(t){e.maxRows=t}function ne(){e.rtl=he.getDocumentDir()==="rtl",fe()}function oe(t){e.cols=Math.floor(t)}c.increaseItem(Q),a.onBeforeMount(()=>{e.rtl=he.getDocumentDir()==="rtl"}),a.onMounted(()=>{c.responsive&&c.lastBreakpoint?e.cols=Me.getColsFromBreakpoint(c.lastBreakpoint,c.cols):e.cols=c.colNum,e.rowHeight=c.rowHeight,e.containerWidth=c.width!==null?c.width:100,e.margin=c.margin!==void 0?c.margin.map(Number):[10,10],e.maxRows=c.maxRows,g.isNull(i.isDraggable)?e.draggable=c.isDraggable:e.draggable=i.isDraggable,g.isNull(i.isResizable)?e.resizable=c.isResizable:e.resizable=i.isResizable,g.isNull(i.isBounded)?e.bounded=c.isBounded:e.bounded=i.isBounded,e.transformScale=c.transformScale,e.useCssTransforms=c.useCssTransforms,e.useStyleCursor=c.useStyleCursor,a.watchEffect(()=>{p=i.x,v=i.y,R=i.h,b=i.w,g.nextTickOnce(k)}),f.on("updateWidth",Z),f.on("compact",U),f.on("setDraggable",ee),f.on("setResizable",te),f.on("setBounded",ie),f.on("setTransformScale",ae),f.on("setRowHeight",se),f.on("setMaxRows",re),f.on("directionchange",ne),f.on("setColNum",oe)}),a.onBeforeUnmount(()=>{f.off("updateWidth",Z),f.off("compact",U),f.off("setDraggable",ee),f.off("setResizable",te),f.off("setBounded",ie),f.off("setTransformScale",ae),f.off("setRowHeight",se),f.off("setMaxRows",re),f.off("directionchange",ne),f.off("setColNum",oe),u.value&&(u.value.unset(),u.value=null),c.decreaseItem(Q)}),ze({state:e,wrapper:C});const ve=typeof navigator<"u"?navigator.userAgent.toLowerCase().includes("android"):!1,E=a.computed(()=>e.resizable&&!i.static),m=a.computed(()=>c.isMirrored?!e.rtl:e.rtl),Re=a.computed(()=>(e.draggable||e.resizable)&&!i.static),w=y.useNameHelper("item"),xe=a.computed(()=>({[w.b()]:!0,[w.bm("resizable")]:E.value,[w.bm("static")]:i.static,[w.bm("resizing")]:e.isResizing,[w.bm("dragging")]:e.isDragging,[w.bm("transform")]:e.useCssTransforms,[w.bm("rtl")]:m.value,[w.bm("no-touch")]:ve&&Re.value})),N=a.computed(()=>[w.be("resizer"),m.value&&w.bem("resizer","rtl")].filter(Boolean)),ye=a.computed(()=>{const t=i.resizeOption;return!(!t||!t.edges)}),Ee=a.computed(()=>E.value&&!ye.value);a.watch(()=>i.isDraggable,t=>{e.draggable=t}),a.watch(()=>i.static,()=>{g.nextTickOnce(me),g.nextTickOnce(H)}),a.watch(()=>e.draggable,()=>{g.nextTickOnce(me)}),a.watch(()=>i.isResizable,t=>{e.resizable=t}),a.watch(()=>i.isBounded,t=>{e.bounded=t}),a.watch(()=>e.resizable,()=>{g.nextTickOnce(H)}),a.watch(()=>e.rowHeight,()=>{g.nextTickOnce(k),g.nextTickOnce(I)}),a.watch([()=>e.cols,()=>e.containerWidth],()=>{g.nextTickOnce(H),g.nextTickOnce(k),g.nextTickOnce(I)}),a.watch([()=>i.minH,()=>i.maxH,()=>i.minW,()=>i.maxW],()=>{g.nextTickOnce(H)}),a.watch(m,()=>{g.nextTickOnce(H),g.nextTickOnce(k)}),a.watch([()=>c.margin,()=>c.margin[0],()=>c.margin[1]],()=>{const t=c.margin;!t||t[0]===e.margin[0]&&t[1]===e.margin[1]||(e.margin=t.map(Number),g.nextTickOnce(k),g.nextTickOnce(I))});function k(){i.x+i.w>e.cols?(p=0,b=i.w>e.cols?e.cols:i.w):(p=i.x,b=i.w);const t=M(p,v,b,R);e.isDragging&&(t.top=e.dragging.top,m.value?t.right=e.dragging.left:t.left=e.dragging.left),e.isResizing&&(t.width=e.resizing.width,t.height=e.resizing.height);let r;e.useCssTransforms?m.value?r=y.setTransformRtl(t.top,t.right,t.width,t.height):r=y.setTransform(t.top,t.left,t.width,t.height):m.value?r=y.setTopRight(t.top,t.right,t.width,t.height):r=y.setTopLeft(t.top,t.left,t.width,t.height),e.style=r}function I(){const t={};for(const r of["width","height"]){const o=e.style[r].match(/^(\d+)px$/);if(!o)return;t[r]=o[1]}S("container-resized",i.i,i.h,i.w,t.height,t.width)}function le(t){if(i.static)return;const r=t.type;if(r==="resizestart"&&e.isResizing||r!=="resizestart"&&!e.isResizing)return;const l=D.getControlPosition(t);if(g.isNull(l))return;const{x:o,y:d}=l,n={width:0,height:0};let s;switch(t.edges&&(e.activeResizeEdges.top=!!t.edges.top,e.activeResizeEdges.right=!!t.edges.right,e.activeResizeEdges.bottom=!!t.edges.bottom,e.activeResizeEdges.left=!!t.edges.left),r){case"resizestart":{H(),j=b,G=R,s=M(p,v,b,R),n.width=s.width,n.height=s.height,e.resizing=n,e.isResizing=!0;break}case"resizemove":{!t.edges.right&&!t.edges.left&&(_=o),!t.edges.top&&!t.edges.bottom&&(O=d);const h=D.createCoreData(_,O,o,d);m.value?n.width=e.resizing.width-h.deltaX/e.transformScale:n.width=e.resizing.width+h.deltaX/e.transformScale,n.height=e.resizing.height+h.deltaY/e.transformScale,e.resizing=n;break}case"resizeend":{s=M(p,v,b,R),n.width=s.width,n.height=s.height,e.resizing={width:-1,height:-1},e.isResizing=!1,e.activeResizeEdges.top=!1,e.activeResizeEdges.right=!1,e.activeResizeEdges.bottom=!1,e.activeResizeEdges.left=!1;break}}s=ke(n.height,n.width),s.w<i.minW&&(s.w=i.minW),s.w>i.maxW&&(s.w=i.maxW),s.h<i.minH&&(s.h=i.minH),s.h>i.maxH&&(s.h=i.maxH),s.h<1&&(s.h=1),s.w<1&&(s.w=1),_=o,O=d,(b!==s.w||R!==s.h)&&S("resize",i.i,s.h,s.w,n.height,n.width),t.type==="resizeend"&&(j!==b||G!==R)&&S("resized",i.i,s.h,s.w,n.height,n.width),f.emit("resizeEvent",t.type,i.i,p,v,s.h,s.w)}function ce(t){if(i.static||e.isResizing)return;const r=t.type;if(r==="dragstart"&&e.isDragging||r!=="dragstart"&&!e.isDragging)return;const l=D.getControlPosition(t);if(g.isNull(l))return;const{x:o,y:d}=l,n=t.target;if(!n.offsetParent)return;const s={top:0,left:0};switch(r){case"dragstart":{K=p,J=v;const z=n.offsetParent.getBoundingClientRect(),x=n.getBoundingClientRect(),B=x.left/e.transformScale,T=z.left/e.transformScale,P=x.right/e.transformScale,A=z.right/e.transformScale,Y=x.top/e.transformScale,L=z.top/e.transformScale;m.value?s.left=(P-A)*-1:s.left=B-T,s.top=Y-L,e.dragging=s,e.isDragging=!0;break}case"dragmove":{const z=D.createCoreData(V,$,o,d);if(m.value?s.left=e.dragging.left-z.deltaX/e.transformScale:s.left=e.dragging.left+z.deltaX/e.transformScale,s.top=e.dragging.top+z.deltaY/e.transformScale,e.bounded){const x=n.offsetParent.clientHeight-ge(i.h,e.rowHeight,e.margin[1]);s.top=de(s.top,0,x);const B=W(),T=e.containerWidth-ge(i.w,B,e.margin[0]);s.left=de(s.left,0,T)}e.dragging=s;break}case"dragend":{const z=n.offsetParent.getBoundingClientRect(),x=n.getBoundingClientRect(),B=x.left/e.transformScale,T=z.left/e.transformScale,P=x.right/e.transformScale,A=z.right/e.transformScale,Y=x.top/e.transformScale,L=z.top/e.transformScale;m.value?s.left=(P-A)*-1:s.left=B-T,s.top=Y-L,e.dragging={top:-1,left:-1},e.isDragging=!1;break}}let h;m.value,h=F(s.top,s.left),V=o,$=d,(p!==h.x||v!==h.y)&&S("move",i.i,h.x,h.y),t.type==="dragend"&&(K!==p||J!==v)&&S("moved",i.i,h.x,h.y),f.emit("dragEvent",t.type,i.i,h.x,h.y,R,b)}function M(t,r,l,o){const d=W();let n;return m.value?n={right:Math.round(d*t+(t+1)*e.margin[0]),top:Math.round(e.rowHeight*r+(r+1)*e.margin[1]),width:l===1/0?l:Math.round(d*l+Math.max(0,l-1)*e.margin[0]),height:o===1/0?o:Math.round(e.rowHeight*o+Math.max(0,o-1)*e.margin[1])}:n={left:Math.round(d*t+(t+1)*e.margin[0]),top:Math.round(e.rowHeight*r+(r+1)*e.margin[1]),width:l===1/0?l:Math.round(d*l+Math.max(0,l-1)*e.margin[0]),height:o===1/0?o:Math.round(e.rowHeight*o+Math.max(0,o-1)*e.margin[1])},n}function F(t,r){const l=W();let o=Math.round((r-e.margin[0])/(l+e.margin[0])),d=Math.round((t-e.margin[1])/(e.rowHeight+e.margin[1]));return o=Math.max(Math.min(o,e.cols-b),0),d=Math.max(Math.min(d,e.maxRows-R),0),{x:o,y:d}}function W(){return(e.containerWidth-e.margin[0]*(e.cols+1))/e.cols}function ge(t,r,l){return Number.isFinite(t)?Math.round(r*t+Math.max(0,t-1)*l):t}function de(t,r,l){return Math.max(Math.min(t,l),r)}function ke(t,r,l=!1){const o=W();let d=Math.round((r+e.margin[0])/(o+e.margin[0])),n=0;return l?n=Math.ceil((t+e.margin[1])/(e.rowHeight+e.margin[1])):n=Math.round((t+e.margin[1])/(e.rowHeight+e.margin[1])),d=Math.max(Math.min(d,e.cols-p),0),n=Math.max(Math.min(n,e.maxRows-v),0),{w:d,h:n}}function He(t,r){e.containerWidth=t}function fe(){k()}function ue(){!u.value&&C.value&&(u.value=pe(C.value),e.useStyleCursor||u.value.styleCursor(!1))}const Se=g.throttle(ce);function me(){if(ue(),!!u.value)if(e.draggable&&!i.static){const t={ignoreFrom:i.dragIgnoreFrom,allowFrom:i.dragAllowFrom,...i.dragOption};u.value.draggable(t),X||(X=!0,u.value.on("dragstart dragmove dragend",r=>{r.type==="dragmove"?Se(r):ce(r)}))}else u.value.draggable({enabled:!1})}const Ce=g.throttle(le);function H(){if(ue(),!!u.value)if(e.resizable&&!i.static){const t=M(0,0,i.maxW,i.maxH),r=M(0,0,i.minW,i.minH),l={edges:{left:m.value?`.${N.value[0]}`:!1,right:m.value?!1:`.${N.value[0]}`,bottom:`.${N.value[0]}`,top:!1},ignoreFrom:i.resizeIgnoreFrom,restrictSize:{min:{height:r.height*e.transformScale,width:r.width*e.transformScale},max:{height:t.height*e.transformScale,width:t.width*e.transformScale}},...i.resizeOption};i.preserveAspectRatio&&(l.modifiers=[pe.modifiers.aspectRatio({ratio:"preserve"})]),u.value.resizable(l);const o=l.edges||{};e.enabledResizeEdges.top=!!o.top,e.enabledResizeEdges.right=!!o.right,e.enabledResizeEdges.bottom=!!o.bottom,e.enabledResizeEdges.left=!!o.left,q||(q=!0,u.value.on("resizestart resizemove resizeend",d=>{d.type==="resizemove"?Ce(d):le(d)}))}else u.value.resizable({enabled:!1}),e.enabledResizeEdges.top=!1,e.enabledResizeEdges.right=!1,e.enabledResizeEdges.bottom=!1,e.enabledResizeEdges.left=!1}return(t,r)=>(a.openBlock(),a.createElementBlock("section",{ref_key:"wrapper",ref:C,class:a.normalizeClass(xe.value),style:a.normalizeStyle(e.style)},[a.renderSlot(t.$slots,"default"),Ee.value?(a.openBlock(),a.createElementBlock("span",{key:0,class:a.normalizeClass(N.value)},null,2)):a.createCommentVNode("",!0),E.value?(a.openBlock(),a.createElementBlock("div",{key:1,class:a.normalizeClass(["vgl-item__edge vgl-item__edge--top",[{"is-enabled":e.enabledResizeEdges.top,"is-active":e.activeResizeEdges.top}]]),"aria-hidden":"true"},null,2)):a.createCommentVNode("",!0),E.value?(a.openBlock(),a.createElementBlock("div",{key:2,class:a.normalizeClass(["vgl-item__edge vgl-item__edge--right",[{"is-enabled":e.enabledResizeEdges.right,"is-active":e.activeResizeEdges.right}]]),"aria-hidden":"true"},null,2)):a.createCommentVNode("",!0),E.value?(a.openBlock(),a.createElementBlock("div",{key:3,class:a.normalizeClass(["vgl-item__edge vgl-item__edge--bottom",[{"is-enabled":e.enabledResizeEdges.bottom,"is-active":e.activeResizeEdges.bottom}]]),"aria-hidden":"true"},null,2)):a.createCommentVNode("",!0),E.value?(a.openBlock(),a.createElementBlock("div",{key:4,class:a.normalizeClass(["vgl-item__edge vgl-item__edge--left",[{"is-enabled":e.enabledResizeEdges.left,"is-active":e.activeResizeEdges.left}]]),"aria-hidden":"true"},null,2)):a.createCommentVNode("",!0)],6))}});module.exports=Be;
//# sourceMappingURL=grid-item.vue.cjs.map
