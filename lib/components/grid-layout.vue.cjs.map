{"version":3,"file":"grid-layout.vue.cjs","sources":["../../src/components/grid-layout.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\n/**\r\n * GridLayout 组件\r\n * 提供网格布局的拖拽、缩放、响应式断点切换及自动高度计算。\r\n * 主要功能：\r\n * 1. 初始化并校验传入布局数据 (validateLayout)\r\n * 2. 监听容器尺寸变化与窗口宽度变化，触发响应式布局重算 (responsiveGridLayout)\r\n * 3. 管理 GridItem 子项的拖拽与缩放事件占位显示 (state.placeholder)\r\n * 4. 根据 verticalCompact 规则压缩布局防止空洞 (compact)\r\n * 5. 在 preventCollision 下避让冲突，或计算最合适的尺寸调整占位\r\n */\r\n\r\nimport {\r\n  nextTick,\r\n  onBeforeMount,\r\n  onBeforeUnmount,\r\n  onMounted,\r\n  provide,\r\n  reactive,\r\n  ref,\r\n  toRefs,\r\n  watch,\r\n} from 'vue'\r\n\r\nimport GridItem from './grid-item.vue'\r\nimport { useResize } from '@vexip-ui/hooks'\r\nimport { createEventEmitter, debounce, isNull } from '@vexip-ui/utils'\r\nimport {\r\n  EMITTER_KEY,\r\n  LAYOUT_KEY,\r\n  bottom,\r\n  cloneLayout,\r\n  compact,\r\n  getAllCollisions,\r\n  getLayoutItem,\r\n  moveElement,\r\n  validateLayout,\r\n} from '../helpers/common'\r\nimport {\r\n  findOrGenerateResponsiveLayout,\r\n  getBreakpointFromWidth,\r\n  getColsFromBreakpoint,\r\n} from '../helpers/responsive'\r\n\r\nimport type { Breakpoint, Layout, LayoutInstance, LayoutItem } from '../helpers/types'\r\nimport type { GridLayoutProps } from './types'\r\n\r\n// Props：控制布局行为的核心参数，含响应式断点、拖拽/缩放开关、压缩策略等\r\nconst props = withDefaults(defineProps<GridLayoutProps>(), {\r\n  autoSize: true, // 是否根据内容自动计算容器高度\r\n  colNum: 12, // 基础列数（非响应式下使用）\r\n  rowHeight: 150, // 每行像素高度用于换算 item 像素尺寸\r\n  maxRows: Infinity, // 最大允许行数限制网格高度\r\n  margin: () => [10, 10], // 每个项的水平/垂直间距 [x, y]\r\n  isDraggable: true, // 全局是否可拖拽\r\n  isResizable: true, // 全局是否可缩放\r\n  isMirrored: false, // 是否启用镜像模式（影响 RTL 渲染方向）\r\n  isBounded: false, // 是否限制在容器内部边界\r\n  useCssTransforms: true, // 是否使用 transform 定位（性能优化）\r\n  verticalCompact: true, // 是否启用垂直压缩（移除上方空隙）\r\n  restoreOnDrag: false, // 拖拽时是否使用拖拽前的紧凑参考进行还原\r\n  responsive: false, // 是否启用断点布局切换\r\n  responsiveLayouts: () => ({}), // 自定义初始各断点布局\r\n  transformScale: 1, // 坐标与尺寸换算缩放比\r\n  breakpoints: () => ({ lg: 1200, md: 996, sm: 768, xs: 480, xxs: 0 }), // 断点宽度映射\r\n  cols: () => ({ lg: 12, md: 10, sm: 6, xs: 4, xxs: 2 }), // 各断点对应列数\r\n  preventCollision: false, // 是否禁止碰撞（发生碰撞时不允许进入）\r\n  useStyleCursor: true, // 是否使用内联光标样式指示交互\r\n})\r\n\r\nconst emit = defineEmits([\r\n  'layout-before-mount',\r\n  'layout-mounted',\r\n  'layout-updated',\r\n  'breakpoint-changed',\r\n  'update:layout',\r\n  'layout-ready',\r\n])\r\n\r\nconst state = reactive({\r\n  /**\r\n   * state：运行时状态记录，包含尺寸、占位、断点缓存与原始布局备份\r\n   * width: 容器当前宽度（用于断点判断）\r\n   * mergedStyle: 传递到根节点的样式对象（主要包含动态高度）\r\n   * lastLayoutLength: 上次布局项数量用于监测增删\r\n   * isDragging: 是否当前存在拖拽或缩放占位显示\r\n   * placeholder: 拖拽/缩放过程中的可视占位项（不参与布局压缩）\r\n   * layouts: 响应式断点对应的布局缓存集合\r\n   * lastBreakpoint: 上一次生效的断点名称（用于比较是否切换）\r\n   * originalLayout: 初始布局副本（响应式回退时需要）\r\n   */\r\n  width: -1,\r\n  mergedStyle: {},\r\n  lastLayoutLength: 0,\r\n  isDragging: false,\r\n  placeholder: {\r\n    x: 0,\r\n    y: 0,\r\n    w: 0,\r\n    h: 0,\r\n    i: '' as number | string,\r\n  },\r\n  layouts: {} as Record<Breakpoint, Layout>, // array to store all layouts from different breakpoints\r\n  lastBreakpoint: null as Breakpoint | null, // store last active breakpoint\r\n  originalLayout: null! as Layout, // store original Layout\r\n})\r\n\r\nconst itemInstances = new Map<number | string, any>()\r\n\r\nconst currentLayout = ref(props.layout)\r\nconst wrapper = ref<HTMLElement>()\r\n\r\nconst { observeResize, unobserveResize } = useResize()\r\nconst emitter = createEventEmitter()\r\n\r\nemitter.on('resizeEvent', resizeEventHandler)\r\nemitter.on('dragEvent', dragEventHandler)\r\n\r\n/**\r\n * onBeforeMount：初始阶段，仅向外部派发 layout-before-mount 事件。\r\n * 目的：提供一个在布局校验与尺寸计算前的时机，便于父级做预加载/骨架处理。\r\n * 特点：不访问 DOM，不做压缩与响应式切换，保证轻量与安全。\r\n */\r\nonBeforeMount(() => {\r\n  emit('layout-before-mount', currentLayout.value)\r\n})\r\n\r\n/**\r\n * onMounted：组件完成挂载后的核心初始化流程（双层 nextTick 保证 DOM 与数据稳定）。\r\n * 步骤：\r\n * 1) 立即 emit(layout-mounted) 通知外部已挂载。\r\n * 2) 第一次 nextTick：validateLayout 校验传入布局并保存 originalLayout 副本。\r\n * 3) 第二次 nextTick：\r\n *    - initResponsiveFeatures 初始化响应式断点缓存\r\n *    - observeResize 注册容器尺寸监听并防抖处理\r\n *    - compact 根据 verticalCompact 压缩布局防空洞\r\n *    - emit(layout-updated) 广播规范化后的布局\r\n *    - updateHeight 计算自适应高度\r\n *    - onWindowResize 主动获取初始 width 并触发子项位置换算\r\n * 设计：分层 nextTick 避免在未稳定的 DOM 状态下计算尺寸，确保子项与外部监听拿到最终可靠的布局。\r\n */\r\nonMounted(() => {\r\n  emit('layout-mounted', currentLayout.value)\r\n\r\n  nextTick(() => {\r\n    validateLayout(currentLayout.value)\r\n\r\n    state.originalLayout = currentLayout.value\r\n\r\n    nextTick(() => {\r\n      initResponsiveFeatures()\r\n      wrapper.value && observeResize(wrapper.value, debounce(onWindowResize, 16))\r\n      compact(currentLayout.value, props.verticalCompact)\r\n      emit('layout-updated', currentLayout.value)\r\n      updateHeight()\r\n      onWindowResize()\r\n    })\r\n  })\r\n})\r\n\r\n/**\r\n * onBeforeUnmount：销毁前清理资源。\r\n * 内容：\r\n * 1) emitter.clearAll() 移除所有事件监听，防止异步残留调用。\r\n * 2) unobserveResize 取消 ResizeObserver，释放浏览器观察资源。\r\n * 不再：广播任何布局事件或修改内部状态，组件即将销毁无需继续同步。\r\n */\r\nonBeforeUnmount(() => {\r\n  emitter.clearAll()\r\n  wrapper.value && unobserveResize(wrapper.value)\r\n})\r\n\r\n/**\r\n * resizeEventHandler\r\n * 转发子项触发的缩放阶段事件到统一的 resizeEvent 逻辑。\r\n * @param eventType 阶段：resizestart | resizemove | resizeend\r\n * @param i 项 id\r\n * @param x 新 x\r\n * @param y 新 y\r\n * @param h 新 h\r\n * @param w 新 w\r\n */\r\nfunction resizeEventHandler(\r\n  eventType: string,\r\n  i: number | string,\r\n  x: number,\r\n  y: number,\r\n  h: number,\r\n  w: number,\r\n) {\r\n  resizeEvent(eventType, i, x, y, h, w)\r\n}\r\n\r\n/**\r\n * dragEventHandler\r\n * 转发子项触发的拖拽阶段事件到统一的 dragEvent 逻辑。\r\n * @param eventType 阶段：dragstart | dragmove | dragend\r\n * @param i 项 id\r\n * @param x 新 x\r\n * @param y 新 y\r\n * @param h 当前高度 h\r\n * @param w 当前宽度 w\r\n */\r\nfunction dragEventHandler(\r\n  eventType: string,\r\n  i: number | string,\r\n  x: number,\r\n  y: number,\r\n  h: number,\r\n  w: number,\r\n) {\r\n  dragEvent(eventType, i, x, y, h, w)\r\n}\r\n\r\n// 监听容器宽度变化：\r\n// 1. 广播 updateWidth 供子项重新计算像素定位；\r\n// 2. 首次从 -1 转为有效值时触发 layout-ready，保证子项尺寸已稳定；\r\n// 3. 随后更新容器高度（autoSize）。\r\nwatch(\r\n  () => state.width,\r\n  (newVal, oldVal) => {\r\n    nextTick(() => {\r\n      emitter.emit('updateWidth', newVal)\r\n      if (oldVal === -1) {\r\n        /*\r\n        oldVal === -1 代表 width 之前从未被设置：\r\n        仅在组件挂载完成且首次 onWindowResize 修改 width 后出现。\r\n        此时 GridItem 已完成尺寸初始化，可以安全地派发 layout-ready 事件。\r\n\r\n        之所以放在 nextTick 中触发，是为了确保上一行触发的 updateWidth\r\n        已经传递并作用到子组件，使其计算出的最终尺寸稳定，\r\n        然后再触发：\r\n        - layout-ready（当前 GridLayout 就绪）\r\n        - item-layout-ready（各 GridItem 就绪，若外部有监听）\r\n\r\n        这样可保证外部监听器读取到的尺寸数据是可靠且最终的。\r\n        */\r\n        nextTick(() => {\r\n          emit('layout-ready', currentLayout.value)\r\n        })\r\n      }\r\n      updateHeight()\r\n    })\r\n  },\r\n)\r\n// 监听外部传入 layout 引用或长度变化：更新 currentLayout 并执行 layoutUpdate（校验新增/删除、压缩与事件广播）。\r\nwatch(\r\n  () => [props.layout, props.layout.length],\r\n  () => {\r\n    currentLayout.value = props.layout\r\n    layoutUpdate()\r\n  },\r\n)\r\n// 监听列数变更：通过事件总线通知子项更新列数以便重新计算宽度和定位。\r\nwatch(\r\n  () => props.colNum,\r\n  val => {\r\n    emitter.emit('setColNum', val)\r\n  },\r\n)\r\n// 监听行高变更：广播给子项用于像素/网格换算更新，并影响容器动态高度。\r\nwatch(\r\n  () => props.rowHeight,\r\n  value => {\r\n    emitter.emit('setRowHeight', value)\r\n  },\r\n)\r\n// 监听全局可拖拽开关：同步到所有子项（未显式覆盖的情况下）。\r\nwatch(\r\n  () => props.isDraggable,\r\n  value => {\r\n    emitter.emit('setDraggable', value)\r\n  },\r\n)\r\n// 监听全局可缩放开关：同步到所有子项（未显式覆盖的情况下）。\r\nwatch(\r\n  () => props.isResizable,\r\n  value => {\r\n    emitter.emit('setResizable', value)\r\n  },\r\n)\r\n// 监听全局边界限制开关：通知子项开启/关闭 bounded 拖拽裁剪。\r\nwatch(\r\n  () => props.isBounded,\r\n  value => {\r\n    emitter.emit('setBounded', value)\r\n  },\r\n)\r\n// 监听缩放比变化：通知子项根据 transformScale 调整拖拽/缩放增量换算。\r\nwatch(\r\n  () => props.transformScale,\r\n  value => {\r\n    emitter.emit('setTransformScale', value)\r\n  },\r\n)\r\n// 监听响应式开关：关闭时恢复 originalLayout 且同步列数；无论开关变化都会触发尺寸重算 onWindowResize。\r\nwatch(\r\n  () => props.responsive,\r\n  value => {\r\n    if (!value) {\r\n      emit('update:layout', state.originalLayout)\r\n      emitter.emit('setColNum', props.colNum)\r\n    }\r\n    onWindowResize()\r\n  },\r\n)\r\n// 监听最大行数变更：同步到子项用于拖拽/缩放边界裁剪。\r\nwatch(\r\n  () => props.maxRows,\r\n  value => {\r\n    emitter.emit('setMaxRows', value)\r\n  },\r\n)\r\n// 监听外部 margin 或垂直间距变化：重新计算容器高度（autoSize）。\r\nwatch([() => props.margin, () => props.margin[1]], updateHeight)\r\n\r\nprovide(\r\n  LAYOUT_KEY,\r\n  reactive({\r\n    ...toRefs(props),\r\n    ...toRefs(state),\r\n    increaseItem,\r\n    decreaseItem,\r\n  }) as LayoutInstance,\r\n)\r\nprovide(EMITTER_KEY, emitter)\r\n\r\ndefineExpose({ state, getItem, resizeEvent, dragEvent, layoutUpdate })\r\n\r\n/**\r\n * increaseItem\r\n * 注册一个 GridItem 实例，便于通过 id 快速检索。\r\n */\r\nfunction increaseItem(item: any) {\r\n  itemInstances.set(item.i, item)\r\n}\r\n\r\n/**\r\n * decreaseItem\r\n * 注销一个 GridItem 实例，释放引用。\r\n */\r\nfunction decreaseItem(item: any) {\r\n  itemInstances.delete(item.i)\r\n}\r\n\r\n/**\r\n * getItem\r\n * 按 id 获取已注册的 GridItem 实例。\r\n */\r\nfunction getItem(id: number | string) {\r\n  return itemInstances.get(id)\r\n}\r\n\r\n/**\r\n * layoutUpdate\r\n * 当外部传入 layout 发生增删变化时：\r\n * 1. 计算差异增量并更新 originalLayout\r\n * 2. 重新初始化响应式缓存\r\n * 3. 压缩并广播更新事件\r\n */\r\nfunction layoutUpdate() {\r\n  if (!isNull(currentLayout.value) && !isNull(state.originalLayout)) {\r\n    if (currentLayout.value.length !== state.originalLayout.length) {\r\n      const diff = findDifference(currentLayout.value, state.originalLayout)\r\n\r\n      if (diff.length > 0) {\r\n        if (currentLayout.value.length > state.originalLayout.length) {\r\n          state.originalLayout = state.originalLayout.concat(diff)\r\n        } else {\r\n          const ids = new Set(diff.map(item => item.i))\r\n          state.originalLayout = state.originalLayout.filter(item => !ids.has(item.i))\r\n        }\r\n      }\r\n\r\n      state.lastLayoutLength = currentLayout.value.length\r\n      initResponsiveFeatures()\r\n    }\r\n\r\n    compact(currentLayout.value, props.verticalCompact)\r\n    emitter.emit('updateWidth', state.width)\r\n    updateHeight()\r\n\r\n    emit('layout-updated', currentLayout.value)\r\n  }\r\n}\r\n\r\n/**\r\n * updateHeight\r\n * 基于当前布局底部坐标计算容器高度（autoSize 为 true 才生效）\r\n */\r\nfunction updateHeight() {\r\n  state.mergedStyle = {\r\n    height: containerHeight(),\r\n  }\r\n}\r\n\r\n/**\r\n * onWindowResize\r\n * 容器尺寸变化回调：更新 width 并广播以通知子项重新计算像素位置\r\n */\r\nfunction onWindowResize() {\r\n  if (wrapper.value) {\r\n    state.width = wrapper.value.offsetWidth\r\n  }\r\n\r\n  emitter.emit('resizeEvent')\r\n}\r\n\r\n/**\r\n * containerHeight\r\n * 计算容器高度：bottom(layout) * (rowHeight + marginY) + marginY\r\n */\r\nfunction containerHeight() {\r\n  if (!props.autoSize) return\r\n\r\n  const marginY = parseFloat(props.margin[1] as any)\r\n  const containerHeight = bottom(currentLayout.value) * (props.rowHeight + marginY) + marginY + 'px'\r\n  return containerHeight\r\n}\r\n\r\nlet positionsBeforeDrag: Record<string, { x: number, y: number }> | undefined\r\n\r\n/**\r\n * dragEvent\r\n * 处理 GridItem 拖拽生命周期：更新占位、调用 moveElement、按需压缩与广播。\r\n * 支持 restoreOnDrag 保持拖拽前紧凑参考位置。\r\n */\r\nfunction dragEvent(\r\n  eventName: string,\r\n  id: number | string,\r\n  x: number,\r\n  y: number,\r\n  h: number,\r\n  w: number,\r\n) {\r\n  let l = getLayoutItem(currentLayout.value, id)!\r\n\r\n  // GetLayoutItem sometimes returns null object\r\n  if (isNull(l)) {\r\n    l = { h: 0, w: 0, x: 0, y: 0, i: '' }\r\n  }\r\n\r\n  if (eventName === 'dragstart' && !props.verticalCompact) {\r\n    positionsBeforeDrag = currentLayout.value.reduce(\r\n      (result, { i, x, y }) => ({\r\n        ...result,\r\n        [i]: { x, y },\r\n      }),\r\n      {},\r\n    )\r\n  }\r\n\r\n  if (eventName === 'dragmove' || eventName === 'dragstart') {\r\n    state.placeholder.i = id\r\n    state.placeholder.x = l.x\r\n    state.placeholder.y = l.y\r\n    state.placeholder.w = w\r\n    state.placeholder.h = h\r\n\r\n    nextTick(() => {\r\n      state.isDragging = true\r\n    })\r\n\r\n    emitter.emit('updateWidth', state.width)\r\n  } else {\r\n    nextTick(() => {\r\n      state.isDragging = false\r\n    })\r\n  }\r\n\r\n  // 将元素移动到拖拽目标位置\r\n  currentLayout.value = moveElement(currentLayout.value, l, x, y, true, props.preventCollision)\r\n\r\n  if (props.restoreOnDrag) {\r\n    // 不要将项目压缩得超过拖拽前布局\r\n    // 暂时设为 static 避免其自身被压缩\r\n    l.static = true\r\n    compact(currentLayout.value, props.verticalCompact, positionsBeforeDrag)\r\n    l.static = false\r\n  } else {\r\n    compact(currentLayout.value, props.verticalCompact)\r\n  }\r\n\r\n  // 由于 Vue 无法检测数组成员属性变更，需要手动触发\r\n  emitter.emit('compact')\r\n  updateHeight()\r\n  if (eventName === 'dragend') {\r\n    positionsBeforeDrag = undefined\r\n    emit('layout-updated', currentLayout.value)\r\n  }\r\n}\r\n\r\n/**\r\n * resizeEvent\r\n * 处理缩放：根据 preventCollision 判断是否需要限制占位尺寸，更新占位与压缩布局。\r\n */\r\nfunction resizeEvent(\r\n  eventName: string | undefined,\r\n  id: number | string,\r\n  x: number,\r\n  y: number,\r\n  h: number,\r\n  w: number,\r\n) {\r\n  let l = getLayoutItem(currentLayout.value, id)!\r\n  // getLayoutItem 有时会返回 null 占位对象\r\n  if (isNull(l)) {\r\n    l = { h: 0, w: 0, x: 0, y: 0, i: '' }\r\n  }\r\n\r\n  let hasCollisions\r\n  if (props.preventCollision) {\r\n    const collisions = getAllCollisions(currentLayout.value, { ...l, w, h }).filter(\r\n      layoutItem => layoutItem.i !== l.i,\r\n    )\r\n    hasCollisions = collisions.length > 0\r\n\r\n    // If we're colliding, we need adjust the placeholder.\r\n    if (hasCollisions) {\r\n      // adjust w && h to maximum allowed space\r\n      let leastX = Infinity\r\n      let leastY = Infinity\r\n      collisions.forEach(layoutItem => {\r\n        if (layoutItem.x > l.x) leastX = Math.min(leastX, layoutItem.x)\r\n        if (layoutItem.y > l.y) leastY = Math.min(leastY, layoutItem.y)\r\n      })\r\n\r\n      if (Number.isFinite(leastX)) l.w = leastX - l.x\r\n      if (Number.isFinite(leastY)) l.h = leastY - l.y\r\n    }\r\n  }\r\n\r\n  if (!hasCollisions) {\r\n    // Set new width and height.\r\n    l.w = w\r\n    l.h = h\r\n  }\r\n\r\n  if (eventName === 'resizestart' || eventName === 'resizemove') {\r\n    state.placeholder.i = id\r\n    state.placeholder.x = x\r\n    state.placeholder.y = y\r\n    state.placeholder.w = l.w\r\n    state.placeholder.h = l.h\r\n    nextTick(() => {\r\n      state.isDragging = true\r\n    })\r\n    // this.$broadcast(\"updateWidth\", this.width);\r\n    emitter.emit('updateWidth', state.width)\r\n  } else if (eventName) {\r\n    nextTick(() => {\r\n      state.isDragging = false\r\n    })\r\n  }\r\n\r\n  if (props.responsive) responsiveGridLayout()\r\n\r\n  compact(currentLayout.value, props.verticalCompact)\r\n  emitter.emit('compact')\r\n  updateHeight()\r\n\r\n  if (eventName === 'resizeend') emit('layout-updated', currentLayout.value)\r\n}\r\n\r\n/**\r\n * responsiveGridLayout\r\n * 根据当前宽度计算断点并生成或提取对应布局，更新列数与触发事件。\r\n */\r\nfunction responsiveGridLayout() {\r\n  const newBreakpoint = getBreakpointFromWidth(props.breakpoints, state.width)\r\n\r\n  if (newBreakpoint === state.lastBreakpoint) {\r\n    return\r\n  }\r\n\r\n  const newCols = getColsFromBreakpoint(newBreakpoint, props.cols)\r\n\r\n  // save actual layout in layouts\r\n  if (!isNull(state.lastBreakpoint) && !state.layouts[state.lastBreakpoint]) {\r\n    state.layouts[state.lastBreakpoint] = cloneLayout(currentLayout.value)\r\n  }\r\n\r\n  // Find or generate a new layout.\r\n  const layout = findOrGenerateResponsiveLayout(\r\n    state.originalLayout,\r\n    state.layouts,\r\n    props.breakpoints,\r\n    newBreakpoint,\r\n    state.lastBreakpoint!,\r\n    newCols,\r\n    props.verticalCompact,\r\n  )\r\n\r\n  // Store the new layout.\r\n  state.layouts[newBreakpoint] = layout\r\n\r\n  if (state.lastBreakpoint !== newBreakpoint) {\r\n    emit('breakpoint-changed', newBreakpoint, layout)\r\n  }\r\n\r\n  currentLayout.value = layout\r\n\r\n  // new prop sync\r\n  emit('update:layout', layout)\r\n\r\n  state.lastBreakpoint = newBreakpoint\r\n  emitter.emit('setColNum', newCols)\r\n}\r\n\r\n/**\r\n * initResponsiveFeatures\r\n * 初始化或重置响应式布局缓存（清空并注入外部预设）。\r\n */\r\nfunction initResponsiveFeatures() {\r\n  // clear layouts\r\n  state.layouts = Object.assign({} as Record<Breakpoint, Layout>, props.responsiveLayouts)\r\n}\r\n\r\n/**\r\n * findDifference\r\n * 计算两个布局在项标识上的差异（增删集合）。用于同步 originalLayout。\r\n */\r\nfunction findDifference(layout: Layout, originalLayout: Layout) {\r\n  const originalIds = new Set(originalLayout.map(item => item.i))\r\n  const ids = new Set(layout.map(item => item.i))\r\n\r\n  // Find values that are in result1 but not in result2\r\n  const uniqueResultOne = layout.filter(item => !originalIds.has(item.i))\r\n\r\n  // Find values that are in result2 but not in result1\r\n  const uniqueResultTwo = originalLayout.filter(item => !ids.has(item.i))\r\n\r\n  // Combine the two arrays of unique entries#\r\n  return uniqueResultOne.concat(uniqueResultTwo)\r\n}\r\n</script>\r\n\r\n<template>\r\n  <!-- 根容器：提供动态高度与插槽渲染，若无默认插槽则按当前布局自动生成 GridItem -->\r\n  <div ref=\"wrapper\" class=\"vgl-layout\" :style=\"state.mergedStyle\">\r\n    <slot v-if=\"$slots.default\"></slot>\r\n    <template v-else>\r\n      <GridItem v-for=\"item in currentLayout\" :key=\"item.i\" v-bind=\"item\">\r\n        <slot name=\"item\" :item=\"item as LayoutItem\"></slot>\r\n      </GridItem>\r\n    </template>\r\n    <!-- 占位元素：拖拽或缩放时显示，与真实项尺寸/位置同步 -->\r\n    <GridItem\r\n      v-show=\"state.isDragging\"\r\n      class=\"vgl-item--placeholder\"\r\n      :x=\"state.placeholder.x\"\r\n      :y=\"state.placeholder.y\"\r\n      :w=\"state.placeholder.w\"\r\n      :h=\"state.placeholder.h\"\r\n      :i=\"state.placeholder.i\"\r\n    ></GridItem>\r\n  </div>\r\n</template>\r\n"],"names":["props","__props","emit","__emit","state","reactive","itemInstances","currentLayout","ref","wrapper","observeResize","unobserveResize","useResize","emitter","createEventEmitter","resizeEventHandler","dragEventHandler","onBeforeMount","onMounted","nextTick","validateLayout","initResponsiveFeatures","debounce","onWindowResize","compact","updateHeight","onBeforeUnmount","eventType","i","x","y","h","w","resizeEvent","dragEvent","watch","newVal","oldVal","layoutUpdate","val","value","provide","LAYOUT_KEY","toRefs","increaseItem","decreaseItem","EMITTER_KEY","__expose","getItem","item","id","isNull","diff","findDifference","ids","containerHeight","marginY","bottom","positionsBeforeDrag","eventName","getLayoutItem","result","moveElement","hasCollisions","collisions","getAllCollisions","layoutItem","leastX","leastY","responsiveGridLayout","newBreakpoint","getBreakpointFromWidth","newCols","getColsFromBreakpoint","cloneLayout","layout","findOrGenerateResponsiveLayout","originalLayout","originalIds","uniqueResultOne","uniqueResultTwo"],"mappings":"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"}