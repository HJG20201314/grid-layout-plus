{"version":3,"file":"DraggableResizableWrapper.vue.cjs","sources":["../../src/components/DraggableResizableWrapper.vue"],"sourcesContent":["<template>\r\n  <div ref=\"elementRef\" class=\"draggable-resizable-wrapper\">\r\n    <slot v-bind=\"slotScope\"></slot>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport {\r\n  type ComputedRef,\r\n  computed, \r\n  onMounted, \r\n  onUnmounted, \r\n  ref, \r\n  watch, \r\n} from 'vue'\r\n\r\nimport { throttle } from '@vexip-ui/utils'\r\n\r\nimport {\r\n  type DraggableResizableWrapperEmits,\r\n  type DraggableResizableWrapperExposed,\r\n  type DraggableResizableWrapperProps,\r\n  type DraggableResizableWrapperSlotScope,\r\n} from './types'\r\n\r\n\r\nimport {\r\n  type DragEventCallbackData,\r\n  type DraggableResizableResult,\r\n  type ElementDragResizeCallbacks,\r\n  type ElementDragResizeOptions,\r\n  type ElementEdges,\r\n  type ResizeEventCallbackData,\r\n  makeElementDraggableResizable,\r\n} from '../utils/interact-helper'\r\nimport { parseCssSize, parsePositionValue } from '../utils/css-units'\r\n\r\n/** 定义组件的 props */\r\nconst props = withDefaults(defineProps<DraggableResizableWrapperProps>(), {\r\n  draggable: true,\r\n  resizable: true,\r\n  useCssTransforms: true,\r\n  dragOptions: () => ({}),\r\n  resizeOptions: () => ({}),\r\n  initialX: 0,\r\n  initialY: 0,\r\n  initialWidth: 200,\r\n  initialHeight: 150,\r\n  watchDeep: false,\r\n  watchImmediate: false,\r\n})\r\n\r\n/** 定义组件的事件 */\r\nconst emit = defineEmits<DraggableResizableWrapperEmits>()\r\n\r\n/** 定义响应式数据 */\r\nconst elementRef = ref<HTMLElement>()\r\n\r\n/** 恢复丢失的响应式状态定义 (位置/尺寸 + 交互状态) */\r\n// 位置和尺寸保持响应式\r\nconst x = ref<number>(typeof props.initialX === 'number' ? props.initialX : 0)\r\nconst y = ref<number>(typeof props.initialY === 'number' ? props.initialY : 0)\r\nconst width = ref<number>(typeof props.initialWidth === 'number' ? props.initialWidth : 200)\r\nconst height = ref<number>(typeof props.initialHeight === 'number' ? props.initialHeight : 150)\r\n\r\n// 定义组件内部状态 - 全部使用响应式变量确保外部可以实时访问\r\nconst isDragging = ref<boolean>(false)\r\nconst isResizing = ref<boolean>(false)\r\nconst activeEdges = ref<Partial<ElementEdges>>({})\r\n\r\n/** 清理函数引用 */\r\nlet cleanupFunction: (() => void) | null = null\r\n\r\n/** 更新位置尺寸方法引用 */\r\nlet updatePositionAndSizeFunction: DraggableResizableResult['updatePositionAndSize'] | null = null\r\nlet updatePositionFunction: DraggableResizableResult['updatePosition'] | null = null\r\nlet updateSizeFunction: DraggableResizableResult['updateSize'] | null = null\r\n\r\n/** watch监听器停止函数引用 */\r\nconst stopWatchListener: (() => void)[] = []\r\n\r\n/** 创建slot作用域数据 */\r\nconst slotScope: ComputedRef<DraggableResizableWrapperSlotScope> = computed(() => ({\r\n  x: x.value,\r\n  y: y.value,\r\n  width: width.value,\r\n  height: height.value,\r\n  isDragging: isDragging.value,\r\n  isResizing: isResizing.value,\r\n  activeEdges: activeEdges.value as Record<string, boolean>,\r\n}))\r\n\r\n/** 创建拖拽和调整大小的回调函数 */\r\nconst createCallbacks = (): ElementDragResizeCallbacks => ({\r\n  onDrag: (data: DragEventCallbackData) => {\r\n    // 性能优化：对于dragmove事件，使用requestAnimationFrame减少响应式更新频率\r\n    if (data.type === 'dragmove') {\r\n      requestAnimationFrame(() => {\r\n        // 更新内部状态\r\n        x.value = data.left\r\n        y.value = data.top\r\n        \r\n        // 发出事件\r\n        emit('dragMove', data)\r\n      })\r\n    } else {\r\n      // 对于dragstart和dragend，立即更新\r\n      if (data.type === 'dragstart') {\r\n        isDragging.value = true\r\n        emit('dragStart', data)\r\n      } else if (data.type === 'dragend') {\r\n        isDragging.value = false\r\n        emit('dragEnd', data)\r\n      }\r\n      // 无论哪种类型，都更新位置\r\n      x.value = data.left\r\n      y.value = data.top\r\n    }\r\n  },\r\n  onResize: (data: ResizeEventCallbackData) => {\r\n    // 性能优化：对于resizemove事件，使用requestAnimationFrame减少响应式更新频率\r\n    if (data.type === 'resizemove') {\r\n      requestAnimationFrame(() => {\r\n        // 更新内部状态\r\n        width.value = data.width\r\n        height.value = data.height\r\n        x.value = data.left\r\n        y.value = data.top\r\n        \r\n        // 发出事件\r\n        emit('resizeMove', data)\r\n      })\r\n    } else {\r\n      // 对于resizestart和resizeend，立即更新\r\n      if (data.type === 'resizestart') {\r\n        isResizing.value = true\r\n        emit('resizeStart', data)\r\n      } else if (data.type === 'resizeend') {\r\n        isResizing.value = false\r\n        emit('resizeEnd', data)\r\n      }\r\n      // 无论哪种类型，都更新位置和尺寸\r\n      width.value = data.width\r\n      height.value = data.height\r\n      x.value = data.left\r\n      y.value = data.top\r\n      activeEdges.value = data.edges || {}\r\n    }\r\n  },\r\n})\r\n\r\n/** 计算选项 - 已使用computed属性缓存计算结果，避免每次渲染都重新创建对象 */\r\nconst computedOptions: ComputedRef<ElementDragResizeOptions> = computed(() => ({\r\n  draggable: props.draggable,\r\n  resizable: props.resizable,\r\n  useCssTransforms: props.useCssTransforms,\r\n  dragOptions: props.dragOptions,\r\n  resizeOptions: props.resizeOptions,\r\n  x: props.initialX,\r\n  y: props.initialY,\r\n  width: props.initialWidth,\r\n  height: props.initialHeight,\r\n}))\r\n\r\n/** 初始化拖拽和调整大小功能 */\r\nconst initializeInteract = (): void => {\r\n  if (!elementRef.value) return\r\n\r\n  // 设置初始数据属性\r\n  elementRef.value.setAttribute('data-x', props.initialX.toString())\r\n  elementRef.value.setAttribute('data-y', props.initialY.toString())\r\n  elementRef.value.setAttribute('data-width', props.initialWidth.toString())\r\n  elementRef.value.setAttribute('data-height', props.initialHeight.toString())\r\n\r\n  // 创建回调函数\r\n  const callbacks = createCallbacks()\r\n\r\n  // 调用 makeElementDraggableResizable\r\n  const result = makeElementDraggableResizable(\r\n    elementRef.value,\r\n    computedOptions.value,\r\n    callbacks,\r\n  )\r\n  cleanupFunction = result.cleanup\r\n  updatePositionAndSizeFunction = result.updatePositionAndSize\r\n  updatePositionFunction = result.updatePosition\r\n  updateSizeFunction = result.updateSize\r\n}\r\n\r\n/** 监听选项变化 - 支持用户配置的deep和immediate选项 */\r\nstopWatchListener.push(\r\n  watch(\r\n    [\r\n      () => props.draggable,\r\n      () => props.resizable,\r\n      () => props.dragOptions,\r\n      () => props.resizeOptions,\r\n    ],\r\n    (): void => {\r\n      if (cleanupFunction) {\r\n        cleanupFunction()\r\n        cleanupFunction = null\r\n      }\r\n      initializeInteract()\r\n    },\r\n    {\r\n      deep: props.watchDeep,\r\n      immediate: props.watchImmediate,\r\n    }),\r\n)\r\n\r\n/** 监听初始位置尺寸变化 - 使用update方法而非重新初始化 */\r\nstopWatchListener.push(\r\n  watch(\r\n    [\r\n      () => props.initialX,\r\n      () => props.initialY,\r\n      () => props.initialWidth,\r\n      () => props.initialHeight,\r\n    ],\r\n    ([newX, newY, newWidth, newHeight]) => {\r\n      if (updatePositionAndSizeFunction) {\r\n        updatePositionAndSizeFunction(newX, newY, newWidth, newHeight)\r\n        if (typeof newX === 'number') x.value = newX\r\n        if (typeof newY === 'number') y.value = newY\r\n        if (typeof newWidth === 'number') width.value = newWidth\r\n        if (typeof newHeight === 'number') height.value = newHeight\r\n      }\r\n    }),\r\n)\r\n\r\n/** 组件挂载时初始化 */\r\nonMounted((): void => {\r\n  initializeInteract()\r\n  // 挂载后如果初始值为字符串单位, 解析为像素更新\r\n  if (typeof props.initialX === 'string') x.value = parsePositionValue(props.initialX, elementRef.value, 'x')\r\n  if (typeof props.initialY === 'string') y.value = parsePositionValue(props.initialY, elementRef.value, 'y')\r\n  if (typeof props.initialWidth === 'string') width.value = parseCssSize(props.initialWidth, elementRef.value, 'width')\r\n  if (typeof props.initialHeight === 'string') height.value = parseCssSize(props.initialHeight, elementRef.value, 'height')\r\n})\r\n\r\n/** 公开方法：更新位置和尺寸 */\r\nconst updatePositionAndSize = throttle((newX: number | string, newY: number | string, newWidth: number | string, newHeight: number | string): void => {\r\n  if (updatePositionAndSizeFunction) {\r\n    updatePositionAndSizeFunction(newX, newY, newWidth, newHeight)\r\n    if (typeof newX === 'number') x.value = newX\r\n    if (typeof newY === 'number') y.value = newY\r\n    if (typeof newWidth === 'number') width.value = newWidth\r\n    if (typeof newHeight === 'number') height.value = newHeight\r\n  }\r\n}, 16)\r\n\r\n/** 公开方法：更新位置 */\r\nconst updatePosition = throttle((newX: number | string, newY: number | string): void => {\r\n  if (updatePositionFunction) {\r\n    updatePositionFunction(newX, newY)\r\n    if (typeof newX === 'number') x.value = newX\r\n    if (typeof newY === 'number') y.value = newY\r\n  }\r\n}, 16)\r\n\r\n/** 公开方法：更新尺寸 */\r\nconst updateSize = throttle((newWidth: number | string, newHeight: number | string): void => {\r\n  if (updateSizeFunction) {\r\n    updateSizeFunction(newWidth, newHeight)\r\n    if (typeof newWidth === 'number') width.value = newWidth\r\n    if (typeof newHeight === 'number') height.value = newHeight\r\n  }\r\n}, 16)\r\n\r\n/** 组件卸载时清理 */\r\nonUnmounted((): void => {\r\n  if (cleanupFunction) {\r\n    cleanupFunction()\r\n    cleanupFunction = null\r\n  }\r\n  if (stopWatchListener?.length) {\r\n    stopWatchListener.forEach((listener) => listener())\r\n    stopWatchListener.length = 0\r\n  }\r\n  updatePositionAndSizeFunction = null\r\n  updatePositionFunction = null\r\n  updateSizeFunction = null\r\n})\r\n\r\n/** 暴露方法给父组件 */\r\ndefineExpose<DraggableResizableWrapperExposed>({\r\n  elementRef,\r\n  x,\r\n  y,\r\n  width,\r\n  height,\r\n  isDragging,\r\n  isResizing,\r\n  activeEdges,\r\n  updatePositionAndSize,\r\n  updatePosition,\r\n  updateSize,\r\n})\r\n</script>\r\n"],"names":["props","__props","emit","__emit","elementRef","ref","x","y","width","height","isDragging","isResizing","activeEdges","cleanupFunction","updatePositionAndSizeFunction","updatePositionFunction","updateSizeFunction","stopWatchListener","slotScope","computed","createCallbacks","data","computedOptions","initializeInteract","callbacks","result","makeElementDraggableResizable","watch","newX","newY","newWidth","newHeight","onMounted","parsePositionValue","parseCssSize","updatePositionAndSize","throttle","updatePosition","updateSize","onUnmounted","listener","__expose"],"mappings":"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"}