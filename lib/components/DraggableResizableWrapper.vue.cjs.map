{"version":3,"file":"DraggableResizableWrapper.vue.cjs","sources":["../../src/components/DraggableResizableWrapper.vue"],"sourcesContent":["<template>\r\n  <div ref=\"elementRef\" class=\"draggable-resizable-wrapper\">\r\n    <slot v-bind=\"slotScope\"></slot>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport {\r\n  type ComputedRef,\r\n  computed, \r\n  onMounted, \r\n  onUnmounted, \r\n  ref, \r\n  watch, \r\n} from 'vue'\r\n\r\nimport {\r\n  type DraggableResizableWrapperEmits,\r\n  type DraggableResizableWrapperExposed,\r\n  type DraggableResizableWrapperProps,\r\n  type DraggableResizableWrapperSlotScope,\r\n} from './types'\r\n\r\n\r\nimport {\r\n  type DragEventCallbackData,\r\n  type DraggableResizableResult,\r\n  type ElementDragResizeCallbacks,\r\n  type ElementDragResizeOptions,\r\n  type ElementEdges,\r\n  type ResizeEventCallbackData,\r\n  makeElementDraggableResizable,\r\n} from '../utils/interact-helper'\r\n\r\n/** 定义组件的 props */\r\nconst props = withDefaults(defineProps<DraggableResizableWrapperProps>(), {\r\n  draggable: true,\r\n  resizable: true,\r\n  useCssTransforms: true,\r\n  dragOptions: () => ({}),\r\n  resizeOptions: () => ({}),\r\n  initialX: 0,\r\n  initialY: 0,\r\n  initialWidth: 200,\r\n  initialHeight: 150,\r\n  watchDeep: false,\r\n  watchImmediate: false,\r\n})\r\n\r\n/** 定义组件的事件 */\r\nconst emit = defineEmits<DraggableResizableWrapperEmits>()\r\n\r\n/** 定义响应式数据 */\r\nconst elementRef = ref<HTMLElement>()\r\nconst x = ref<number>(typeof props.initialX === 'number' ? props.initialX : 0)\r\nconst y = ref<number>(typeof props.initialY === 'number' ? props.initialY : 0)\r\nconst width = ref<number>(typeof props.initialWidth === 'number' ? props.initialWidth : 200)\r\nconst height = ref<number>(typeof props.initialHeight === 'number' ? props.initialHeight : 150)\r\nconst isDragging = ref<boolean>(false)\r\nconst isResizing = ref<boolean>(false)\r\nconst activeEdges = ref<Partial<ElementEdges>>({})\r\n\r\n/** 清理函数引用 */\r\nlet cleanupFunction: (() => void) | null = null\r\n\r\n/** 更新位置尺寸方法引用 */\r\nlet updatePositionAndSizeFunction: DraggableResizableResult['updatePositionAndSize'] | null = null\r\nlet updatePositionFunction: DraggableResizableResult['updatePosition'] | null = null\r\nlet updateSizeFunction: DraggableResizableResult['updateSize'] | null = null\r\n\r\n/** watch监听器停止函数引用 */\r\nconst stopWatchListener: (() => void)[] = []\r\n\r\n/** 创建slot作用域数据 */\r\nconst slotScope: ComputedRef<DraggableResizableWrapperSlotScope> = computed(() => ({\r\n  x: x.value,\r\n  y: y.value,\r\n  width: width.value,\r\n  height: height.value,\r\n  isDragging: isDragging.value,\r\n  isResizing: isResizing.value,\r\n  activeEdges: activeEdges.value as Record<string, boolean>,\r\n}))\r\n\r\n/** 创建拖拽和调整大小的回调函数 */\r\nconst createCallbacks = (): ElementDragResizeCallbacks => ({\r\n  onDrag: (data: DragEventCallbackData) => {\r\n    // 更新内部状态\r\n    x.value = data.left\r\n    y.value = data.top\r\n    isDragging.value =\r\n      data.type === 'dragstart' ? true : data.type === 'dragend' ? false : isDragging.value\r\n\r\n    // 发出对应事件\r\n    switch (data.type) {\r\n      case 'dragstart':\r\n        emit('dragStart', data)\r\n        break\r\n      case 'dragmove':\r\n        emit('dragMove', data)\r\n        break\r\n      case 'dragend':\r\n        emit('dragEnd', data)\r\n        break\r\n    }\r\n  },\r\n  onResize: (data: ResizeEventCallbackData) => {\r\n    // 更新内部状态\r\n    width.value = data.width\r\n    height.value = data.height\r\n    x.value = data.left\r\n    y.value = data.top\r\n    isResizing.value =\r\n      data.type === 'resizestart' ? true : data.type === 'resizeend' ? false : isResizing.value\r\n    activeEdges.value = data.edges || {}\r\n\r\n    // 发出对应事件\r\n    switch (data.type) {\r\n      case 'resizestart':\r\n        emit('resizeStart', data)\r\n        break\r\n      case 'resizemove':\r\n        emit('resizeMove', data)\r\n        break\r\n      case 'resizeend':\r\n        emit('resizeEnd', data)\r\n        break\r\n    }\r\n  },\r\n})\r\n\r\n/** 计算选项 */\r\nconst computedOptions: ComputedRef<ElementDragResizeOptions> = computed(() => ({\r\n  draggable: props.draggable,\r\n  resizable: props.resizable,\r\n  useCssTransforms: props.useCssTransforms,\r\n  dragOptions: props.dragOptions,\r\n  resizeOptions: props.resizeOptions,\r\n  x: props.initialX,\r\n  y: props.initialY,\r\n  width: props.initialWidth,\r\n  height: props.initialHeight,\r\n}))\r\n\r\n/** 初始化拖拽和调整大小功能 */\r\nconst initializeInteract = (): void => {\r\n  if (!elementRef.value) return\r\n\r\n  // 设置初始数据属性\r\n  elementRef.value.setAttribute('data-x', props.initialX.toString())\r\n  elementRef.value.setAttribute('data-y', props.initialY.toString())\r\n  elementRef.value.setAttribute('data-width', props.initialWidth.toString())\r\n  elementRef.value.setAttribute('data-height', props.initialHeight.toString())\r\n\r\n  // 创建回调函数\r\n  const callbacks = createCallbacks()\r\n\r\n  // 调用 makeElementDraggableResizable\r\n  const result = makeElementDraggableResizable(\r\n    elementRef.value,\r\n    computedOptions.value,\r\n    callbacks,\r\n  )\r\n  cleanupFunction = result.cleanup\r\n  updatePositionAndSizeFunction = result.updatePositionAndSize\r\n  updatePositionFunction = result.updatePosition\r\n  updateSizeFunction = result.updateSize\r\n}\r\n\r\n/** 监听选项变化 - 支持用户配置的deep和immediate选项 */\r\nstopWatchListener.push(\r\n  watch(\r\n    [\r\n      () => props.draggable,\r\n      () => props.resizable,\r\n      () => props.dragOptions,\r\n      () => props.resizeOptions,\r\n    ],\r\n    (): void => {\r\n      if (cleanupFunction) {\r\n        cleanupFunction()\r\n        cleanupFunction = null\r\n      }\r\n      initializeInteract()\r\n    },\r\n    {\r\n      deep: props.watchDeep,\r\n      immediate: props.watchImmediate,\r\n    }),\r\n)\r\n\r\n/** 监听初始位置尺寸变化 - 使用update方法而非重新初始化 */\r\nstopWatchListener.push(\r\n  watch(\r\n    [\r\n      () => props.initialX,\r\n      () => props.initialY,\r\n      () => props.initialWidth,\r\n      () => props.initialHeight,\r\n    ],\r\n    ([newX, newY, newWidth, newHeight]) => {\r\n      if (updatePositionAndSizeFunction) {\r\n        updatePositionAndSizeFunction(newX, newY, newWidth, newHeight)\r\n        if (typeof newX === 'number') x.value = newX\r\n        if (typeof newY === 'number') y.value = newY\r\n        if (typeof newWidth === 'number') width.value = newWidth\r\n        if (typeof newHeight === 'number') height.value = newHeight\r\n      }\r\n    }),\r\n)\r\n\r\n/** 组件挂载时初始化 */\r\nonMounted((): void => {\r\n  initializeInteract()\r\n})\r\n\r\n/** 公开方法：更新位置和尺寸 */\r\nconst updatePositionAndSize = (newX: number | string, newY: number | string, newWidth: number | string, newHeight: number | string): void => {\r\n  if (updatePositionAndSizeFunction) {\r\n    updatePositionAndSizeFunction(newX, newY, newWidth, newHeight)\r\n    if (typeof newX === 'number') x.value = newX\r\n    if (typeof newY === 'number') y.value = newY\r\n    if (typeof newWidth === 'number') width.value = newWidth\r\n    if (typeof newHeight === 'number') height.value = newHeight\r\n  }\r\n}\r\n\r\n/** 公开方法：更新位置 */\r\nconst updatePosition = (newX: number | string, newY: number | string): void => {\r\n  if (updatePositionFunction) {\r\n    updatePositionFunction(newX, newY)\r\n    if (typeof newX === 'number') x.value = newX\r\n    if (typeof newY === 'number') y.value = newY\r\n  }\r\n}\r\n\r\n/** 公开方法：更新尺寸 */\r\nconst updateSize = (newWidth: number | string, newHeight: number | string): void => {\r\n  if (updateSizeFunction) {\r\n    updateSizeFunction(newWidth, newHeight)\r\n    if (typeof newWidth === 'number') width.value = newWidth\r\n    if (typeof newHeight === 'number') height.value = newHeight\r\n  }\r\n}\r\n\r\n/** 组件卸载时清理 */\r\nonUnmounted((): void => {\r\n  if (cleanupFunction) {\r\n    cleanupFunction()\r\n    cleanupFunction = null\r\n  }\r\n  if (stopWatchListener?.length) {\r\n    stopWatchListener.forEach((listener) => listener())\r\n    stopWatchListener.length = 0\r\n  }\r\n  updatePositionAndSizeFunction = null\r\n  updatePositionFunction = null\r\n  updateSizeFunction = null\r\n})\r\n\r\n/** 暴露方法给父组件 */\r\ndefineExpose<DraggableResizableWrapperExposed>({\r\n  elementRef,\r\n  x,\r\n  y,\r\n  width,\r\n  height,\r\n  isDragging,\r\n  isResizing,\r\n  activeEdges,\r\n  updatePositionAndSize,\r\n  updatePosition,\r\n  updateSize,\r\n})\r\n</script>\r\n"],"names":["props","__props","emit","__emit","elementRef","ref","x","y","width","height","isDragging","isResizing","activeEdges","cleanupFunction","updatePositionAndSizeFunction","updatePositionFunction","updateSizeFunction","stopWatchListener","slotScope","computed","createCallbacks","data","computedOptions","initializeInteract","callbacks","result","makeElementDraggableResizable","watch","newX","newY","newWidth","newHeight","onMounted","updatePositionAndSize","updatePosition","updateSize","onUnmounted","listener","__expose"],"mappings":"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"}