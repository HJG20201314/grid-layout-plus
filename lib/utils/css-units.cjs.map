{"version":3,"file":"css-units.cjs","sources":["../../src/utils/css-units.ts"],"sourcesContent":["// 通用 CSS 单位解析工具方法抽离\r\n// 提供: isCssUnitValue, parseCssSize, parsePositionValue\r\n// 统一在交互与包装组件中使用, 避免重复逻辑\r\n\r\nexport const isCssUnitValue = (val: unknown): val is string => typeof val === 'string' && /(px|%|vw|vh|rem|em|calc\\(|ch|ex)/i.test(val || '')\r\n\r\n/**\r\n * 解析尺寸值(宽/高)为像素\r\n * @param size 要解析的尺寸值, 支持 number | string (px,% ,vw,vh,rem,em,calc,ch,ex)\r\n * @param element 关联元素, 用于 % / em / calc 降级测量\r\n * @param direction width|height 用于 % 基准选择\r\n */\r\nexport function parseCssSize(\r\n  size: number | string,\r\n  element: HTMLElement | SVGElement | null | undefined,\r\n  direction: 'width' | 'height' = 'width',\r\n): number {\r\n  if (typeof size === 'number') return size\r\n  if (typeof size !== 'string' || !size) return 0\r\n\r\n  const raw = size.trim()\r\n  // 纯数字\r\n  if (/^[-+]?[0-9]*\\.?[0-9]+$/.test(raw)) return parseFloat(raw)\r\n  // px\r\n  if (/px$/i.test(raw)) return parseFloat(raw)\r\n  // vh / vw\r\n  if (/vh$/i.test(raw)) { const v = parseFloat(raw); return isNaN(v) ? 0 : window.innerHeight * v / 100 }\r\n  if (/vw$/i.test(raw)) { const v = parseFloat(raw); return isNaN(v) ? 0 : window.innerWidth * v / 100 }\r\n  // rem\r\n  if (/rem$/i.test(raw)) { const v = parseFloat(raw); const rootSize = parseFloat(getComputedStyle(document.documentElement).fontSize) || 16; return rootSize * v }\r\n  // em\r\n  if (/em$/i.test(raw)) {\r\n    const v = parseFloat(raw)\r\n    const selfSize = element instanceof HTMLElement\r\n      ? parseFloat(getComputedStyle(element).fontSize)\r\n      : parseFloat(getComputedStyle(document.documentElement).fontSize)\r\n    return (selfSize || 16) * v\r\n  }\r\n  // 百分比 (需要父元素)\r\n  if (/%$/i.test(raw)) {\r\n    const v = parseFloat(raw)\r\n    const parent = element instanceof HTMLElement ? element.parentElement : null\r\n    if (!parent || isNaN(v)) return 0\r\n    const rect = parent.getBoundingClientRect()\r\n    const base = direction === 'width' ? rect.width : rect.height\r\n    return base * v / 100\r\n  }\r\n  // calc(...) 及其它复杂表达式降级测量\r\n  if (/calc\\(/i.test(raw) || /(ch|ex)$/i.test(raw) || isCssUnitValue(raw)) {\r\n    return measureFallback(raw, element, direction)\r\n  }\r\n  // 未匹配则返回0\r\n  return 0\r\n}\r\n\r\nfunction measureFallback(raw: string, element: HTMLElement | SVGElement | null | undefined, direction: 'width' | 'height'): number {\r\n  const temp = document.createElement('div')\r\n  temp.style.position = 'absolute'\r\n  temp.style.visibility = 'hidden'\r\n  temp.style.pointerEvents = 'none'\r\n  temp.style.margin = '0'\r\n  temp.style.padding = '0'\r\n  temp.style.border = '0'\r\n  temp.style.boxSizing = 'border-box'\r\n  if (direction === 'width') temp.style.width = raw; else temp.style.height = raw\r\n  const container = (element instanceof HTMLElement && element.parentElement) || document.body\r\n  container.appendChild(temp)\r\n  const pixels = parseFloat(getComputedStyle(temp)[direction])\r\n  temp.remove()\r\n  return isNaN(pixels) ? 0 : pixels\r\n}\r\n\r\n/**\r\n * 解析位置值 (x/y) 为像素, x 使用 width 语义, y 使用 height 语义\r\n */\r\nexport function parsePositionValue(\r\n  value: number | string,\r\n  element: HTMLElement | SVGElement | null | undefined,\r\n  axis: 'x' | 'y',\r\n): number {\r\n  if (typeof value === 'number') return value\r\n  if (!isCssUnitValue(value)) return parseFloat(value) || 0\r\n  return parseCssSize(value, element, axis === 'x' ? 'width' : 'height')\r\n}\r\n"],"names":["isCssUnitValue","val","parseCssSize","size","element","direction","raw","v","parent","rect","measureFallback","temp","pixels","parsePositionValue","value","axis"],"mappings":"gFAIa,MAAAA,EAAkBC,GAAgC,OAAOA,GAAQ,UAAY,oCAAoC,KAAKA,GAAO,EAAE,EAQrI,SAASC,EACdC,EACAC,EACAC,EAAgC,QACxB,CACJ,GAAA,OAAOF,GAAS,SAAiB,OAAAA,EACrC,GAAI,OAAOA,GAAS,UAAY,CAACA,EAAa,MAAA,GAExC,MAAAG,EAAMH,EAAK,KAAK,EAItB,GAFI,yBAAyB,KAAKG,CAAG,GAEjC,OAAO,KAAKA,CAAG,EAAG,OAAO,WAAWA,CAAG,EAEvC,GAAA,OAAO,KAAKA,CAAG,EAAG,CAAQ,MAAAC,EAAI,WAAWD,CAAG,EAAG,OAAO,MAAMC,CAAC,EAAI,EAAI,OAAO,YAAcA,EAAI,GAAA,CAC9F,GAAA,OAAO,KAAKD,CAAG,EAAG,CAAQ,MAAAC,EAAI,WAAWD,CAAG,EAAG,OAAO,MAAMC,CAAC,EAAI,EAAI,OAAO,WAAaA,EAAI,GAAA,CAE7F,GAAA,QAAQ,KAAKD,CAAG,EAAG,CAAQ,MAAAC,EAAI,WAAWD,CAAG,EAA2F,OAAvE,WAAW,iBAAiB,SAAS,eAAe,EAAE,QAAQ,GAAK,IAAsBC,CAAA,CAE1J,GAAA,OAAO,KAAKD,CAAG,EAAG,CACd,MAAAC,EAAI,WAAWD,CAAG,EAIxB,QAHiBF,aAAmB,YAChC,WAAW,iBAAiBA,CAAO,EAAE,QAAQ,EAC7C,WAAW,iBAAiB,SAAS,eAAe,EAAE,QAAQ,IAC9C,IAAMG,CAAA,CAGxB,GAAA,MAAM,KAAKD,CAAG,EAAG,CACb,MAAAC,EAAI,WAAWD,CAAG,EAClBE,EAASJ,aAAmB,YAAcA,EAAQ,cAAgB,KACxE,GAAI,CAACI,GAAU,MAAMD,CAAC,EAAU,MAAA,GAC1B,MAAAE,EAAOD,EAAO,sBAAsB,EAE1C,OADaH,IAAc,QAAUI,EAAK,MAAQA,EAAK,QACzCF,EAAI,GAAA,CAGhB,MAAA,UAAU,KAAKD,CAAG,GAAK,YAAY,KAAKA,CAAG,GAAKN,EAAeM,CAAG,EAC7DI,EAAgBJ,EAAKF,EAASC,CAAS,EAGzC,CACT,CAEA,SAASK,EAAgBJ,EAAaF,EAAsDC,EAAuC,CAC3H,MAAAM,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,MAAM,SAAW,WACtBA,EAAK,MAAM,WAAa,SACxBA,EAAK,MAAM,cAAgB,OAC3BA,EAAK,MAAM,OAAS,IACpBA,EAAK,MAAM,QAAU,IACrBA,EAAK,MAAM,OAAS,IACpBA,EAAK,MAAM,UAAY,aACnBN,IAAc,QAAcM,EAAA,MAAM,MAAQL,EAAUK,EAAK,MAAM,OAASL,GACzDF,aAAmB,aAAeA,EAAQ,eAAkB,SAAS,MAC9E,YAAYO,CAAI,EAC1B,MAAMC,EAAS,WAAW,iBAAiBD,CAAI,EAAEN,CAAS,CAAC,EAC3D,OAAAM,EAAK,OAAO,EACL,MAAMC,CAAM,EAAI,EAAIA,CAC7B,CAKgB,SAAAC,EACdC,EACAV,EACAW,EACQ,CACJ,OAAA,OAAOD,GAAU,SAAiBA,EACjCd,EAAec,CAAK,EAClBZ,EAAaY,EAAOV,EAASW,IAAS,IAAM,QAAU,QAAQ,EADlC,WAAWD,CAAK,GAAK,CAE1D"}