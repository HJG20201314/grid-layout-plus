"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const Bt=require("interactjs"),Dt=require("@vexip-ui/utils"),u=require("./css-units.cjs"),Vt=2;function Wt(i,$t={},d){const H={...{draggable:!0,resizable:!0,useCssTransforms:!0,dragOptions:{},resizeOptions:{edges:{top:!1,right:!1,bottom:!1,left:!1},margin:8},x:0,y:0,width:0,height:0},...$t},{draggable:q,resizable:U,useCssTransforms:T,dragOptions:g,resizeOptions:t}=H,z=(o,r)=>i.getAttribute(`data-${o}`)||r,B=(o,r)=>{i.setAttribute(`data-${o}`,r.toString())},K=i.getBoundingClientRect(),N=H.width||K.width||0,Q=H.height||K.height||0;B("x",H.x||0),B("y",H.y||0),B("width",N.toString()),B("height",Q.toString());const At=z("x","0"),Rt=z("y","0"),bt=z("width",N.toString()),Lt=z("height",Q.toString());let n=u.parsePositionValue(At,i,"x"),f=u.parsePositionValue(Rt,i,"y"),m=u.parseCssSize(bt,i,"width"),y=u.parseCssSize(Lt,i,"height");const R=new Map;let j=!1;const D=o=>{if(i instanceof HTMLElement){const r=getComputedStyle(i);return(r.position==="absolute"||r.position==="fixed")&&r[o]!=="auto"&&r[o]!==""}return!1},V=()=>D("right"),Y=()=>D("left"),X=()=>D("top"),W=()=>D("bottom"),Mt=o=>{["top","right","bottom","left"].forEach(r=>{const p=R.get(r);p&&(p.style.backgroundColor=o[r]?"rgba(29, 98, 236, 1)":"rgba(29, 98, 236, 0)")})},Pt=()=>{R.forEach(o=>{o.style.backgroundColor="rgba(29, 98, 236, 0)"})},Ht=()=>{const o=(t==null?void 0:t.edges)||{},r=(t==null?void 0:t.margin)??4,p={position:"absolute",backgroundColor:"rgba(29, 98, 236, 0)",pointerEvents:"auto",transition:"background-color 0.1s ease"},l=s=>{const a=()=>{s.style.backgroundColor="rgba(29, 98, 236, 1)"},h=()=>{j||(s.style.backgroundColor="rgba(29, 98, 236, 0)")};s.addEventListener("mouseenter",a),s.addEventListener("mouseleave",h),s._mouseEnterListener=a,s._mouseLeaveListener=h};if(o.top){const s=document.createElement("div");Object.assign(s.style,p,{top:`-${r}px`,left:"0",width:"100%",height:"2px",cursor:"row-resize",zIndex:"10"}),l(s),i.appendChild(s),R.set("top",s)}if(o.right){const s=document.createElement("div");Object.assign(s.style,p,{top:"0",right:`-${r}px`,width:"2px",height:"100%",cursor:"col-resize",zIndex:"10"}),l(s),i.appendChild(s),R.set("right",s)}if(o.bottom){const s=document.createElement("div");Object.assign(s.style,p,{bottom:`-${r}px`,left:"0",width:"100%",height:"2px",cursor:"row-resize",zIndex:"10"}),l(s),i.appendChild(s),R.set("bottom",s)}if(o.left){const s=document.createElement("div");Object.assign(s.style,p,{top:"0",left:`-${r}px`,width:"2px",height:"100%",cursor:"col-resize",zIndex:"10"}),l(s),i.appendChild(s),R.set("left",s)}},wt=o=>{R.forEach(r=>{r.style.pointerEvents="auto",r.style.display="block"})},L=Bt(i).styleCursor(!1);if(q){const o=a=>{var h;U&&t&&L.resizable(!1),(h=d==null?void 0:d.onDrag)==null||h.call(d,{type:"dragstart",top:f,left:n,deltaX:0,deltaY:0})},r=a=>{if(n+=a.dx,f+=a.dy,a.target instanceof HTMLElement){const h=getComputedStyle(a.target),_=h.position==="absolute"||h.position==="fixed";T&&!_?a.target.style.transform=`translate(${n}px, ${f}px)`:_?(Y()?a.target.style.left=`${n}px`:V()?V()&&(a.target.style.right=`${-n}px`):a.target.style.left=`${n}px`,X()?a.target.style.top=`${f}px`:W()?W()&&(a.target.style.bottom=`${-f}px`):a.target.style.top=`${f}px`):a.target.style.transform=`translate(${n}px, ${f}px)`}a.target._dataUpdateTimer||(a.target._dataUpdateTimer=setTimeout(()=>{a.target instanceof Element&&(a.target.setAttribute("data-x",n.toString()),a.target.setAttribute("data-y",f.toString())),delete a.target._dataUpdateTimer},50)),d!=null&&d.onDrag&&requestAnimationFrame(()=>{var h;(h=d.onDrag)==null||h.call(d,{type:"dragmove",top:f,left:n,deltaX:a.dx,deltaY:a.dy})})},p=a=>{var h;U&&t&&L.resizable(!0),a.target instanceof Element&&(a.target.setAttribute("data-x",n.toString()),a.target.setAttribute("data-y",f.toString())),(h=d==null?void 0:d.onDrag)==null||h.call(d,{type:"dragend",top:f,left:n,deltaX:a.dx,deltaY:a.dy})},l=Dt.throttle(r,(g==null?void 0:g.threshold)??Vt),s={enabled:!0,allowFrom:g==null?void 0:g.allowFrom,ignoreFrom:g==null?void 0:g.ignoreFrom,modifiers:(g==null?void 0:g.modifiers)||[],listeners:{start:o,move:l,end:p}};g!=null&&g.startAxis&&(s.startAxis=g.startAxis),g!=null&&g.lockAxis&&(s.lockAxis=g.lockAxis),(g==null?void 0:g.max)!==void 0&&(s.max=g.max),(g==null?void 0:g.maxPerElement)!==void 0&&(s.maxPerElement=g.maxPerElement),L.draggable(s)}if(U&&t){Ht();let o=10,r=10,p=1/0,l=1/0,s=m/y;const a=e=>{var E,S,C,M;wt(),j=!0,q&&g&&L.draggable(!1);const $={top:!!((E=e.edges)!=null&&E.top),right:!!((S=e.edges)!=null&&S.right),bottom:!!((C=e.edges)!=null&&C.bottom),left:!!((M=e.edges)!=null&&M.left)};Mt($),o=u.parseCssSize((t==null?void 0:t.minWidth)??10,e.target,"width"),r=u.parseCssSize((t==null?void 0:t.minHeight)??10,e.target,"height"),p=u.parseCssSize((t==null?void 0:t.maxWidth)??1/0,e.target,"width"),l=u.parseCssSize((t==null?void 0:t.maxHeight)??1/0,e.target,"height"),s=m/y,d!=null&&d.onResize&&requestAnimationFrame(()=>{var A;(A=d.onResize)==null||A.call(d,{type:"resizestart",width:m,height:y,top:f,left:n,deltaWidth:0,deltaHeight:0,edges:$})})},h=e=>{var O,k,tt,et,it,ot,st,rt,at,dt,gt,nt,ft,ht,ut,pt,lt,mt,yt,xt,ct,Et,St,Ct;const $=V(),E=Y(),S=X(),C=W(),M=e.target instanceof HTMLElement?getComputedStyle(e.target):null,A=((O=e.deltaRect)==null?void 0:O.width)||0,P=((k=e.deltaRect)==null?void 0:k.height)||0;let b=A,w=P;t!=null&&t.preserveAspectRatio&&!$&&!E&&!S&&!C&&((tt=e.edges)!=null&&tt.left||(et=e.edges)!=null&&et.right?w=A/s:((it=e.edges)!=null&&it.top||(ot=e.edges)!=null&&ot.bottom)&&(b=P*s));let F=m+b,I=y+w;if(F=Math.max(o,Math.min(p,F)),I=Math.max(r,Math.min(l,I)),b=F-m,w=I-y,b===0&&w===0)return;if(($||E||S||C)&&M){const x=e.target.getBoundingClientRect();(Math.abs(x.width-m)>1||Math.abs(x.height-y)>1)&&(m=x.width,y=x.height)}if(!$&&!E&&!S&&!C&&((st=e.edges)!=null&&st.top&&(f-=w),(rt=e.edges)!=null&&rt.right,(at=e.edges)!=null&&at.bottom,(dt=e.edges)!=null&&dt.left&&(n-=b)),m=F,y=I,((gt=e.edges)!=null&&gt.left||(nt=e.edges)!=null&&nt.right)&&(e.target.style.width=`${m}px`),((ft=e.edges)!=null&&ft.top||(ht=e.edges)!=null&&ht.bottom)&&(e.target.style.height=`${y}px`),(ut=e.edges)!=null&&ut.top&&C){const x=(pt=e.target.parentElement)==null?void 0:pt.getBoundingClientRect();if(x){const G=parseInt(getComputedStyle(e.target).bottom||"0",10),J=x.height-y-G;e.target.style.top=`${J}px`}}if((lt=e.edges)!=null&&lt.left&&$){const x=(mt=e.target.parentElement)==null?void 0:mt.getBoundingClientRect();if(x){const G=parseInt(getComputedStyle(e.target).right||"0",10),J=x.width-m-G;e.target.style.left=`${J}px`}}if((yt=e.edges)!=null&&yt.right&&E){const x=parseInt(getComputedStyle(e.target).left||"0",10);e.target.style.left=`${x}px`}if((xt=e.edges)!=null&&xt.bottom&&S){const x=parseInt(getComputedStyle(e.target).top||"0",10);e.target.style.top=`${x}px`}!$&&!E&&!S&&!C&&T&&(e.target.style.transform=`translate(${n}px, ${f}px)`);const zt={top:!!((ct=e.edges)!=null&&ct.top),right:!!((Et=e.edges)!=null&&Et.right),bottom:!!((St=e.edges)!=null&&St.bottom),left:!!((Ct=e.edges)!=null&&Ct.left)};d!=null&&d.onResize&&requestAnimationFrame(()=>{var x;(x=d.onResize)==null||x.call(d,{type:"resizemove",width:m,height:y,top:f,left:n,deltaWidth:A,deltaHeight:P,edges:zt})})},_=e=>{var E,S,C,M;j=!1,q&&g&&L.draggable(!0),Pt(),e.target instanceof Element&&(e.target.setAttribute("data-x",n.toString()),e.target.setAttribute("data-y",f.toString()),e.target.setAttribute("data-width",m.toString()),e.target.setAttribute("data-height",y.toString()));const $={top:!!((E=e.edges)!=null&&E.top),right:!!((S=e.edges)!=null&&S.right),bottom:!!((C=e.edges)!=null&&C.bottom),left:!!((M=e.edges)!=null&&M.left)};requestAnimationFrame(()=>{var A,P,b;(b=d==null?void 0:d.onResize)==null||b.call(d,{type:"resizeend",width:m,height:y,top:f,left:n,deltaWidth:((A=e.deltaRect)==null?void 0:A.width)||0,deltaHeight:((P=e.deltaRect)==null?void 0:P.height)||0,edges:$})})},Tt=h,c={enabled:!0,edges:(t==null?void 0:t.edges)||{},modifiers:(t==null?void 0:t.modifiers)||[],listeners:{start:a,move:Tt,end:_}};(t==null?void 0:t.square)!==void 0&&(c.square=t.square),(t==null?void 0:t.preserveAspectRatio)!==void 0&&(c.preserveAspectRatio=t.preserveAspectRatio),t!=null&&t.invert&&(c.invert=t.invert),(t==null?void 0:t.margin)!==void 0&&(c.margin=t.margin),(t==null?void 0:t.max)!==void 0&&(c.max=t.max),(t==null?void 0:t.maxPerElement)!==void 0&&(c.maxPerElement=t.maxPerElement),(t==null?void 0:t.minWidth)!==void 0&&(c.minWidth=u.parseCssSize(t.minWidth,i,"width")),(t==null?void 0:t.minHeight)!==void 0&&(c.minHeight=u.parseCssSize(t.minHeight,i,"height")),(t==null?void 0:t.maxWidth)!==void 0&&(c.maxWidth=u.parseCssSize(t.maxWidth,i,"width")),(t==null?void 0:t.maxHeight)!==void 0&&(c.maxHeight=u.parseCssSize(t.maxHeight,i,"height"));try{L.resizable(c)}catch(e){console.error("Error setting up resizable:",e)}}if(i instanceof HTMLElement&&(i.style.transition="none",i.style.width=`${m}px`,i.style.height=`${y}px`),i instanceof HTMLElement){const o=getComputedStyle(i),r=o.position==="absolute"||o.position==="fixed";T&&!r?i.style.transform=`translate(${n}px, ${f}px)`:r?(!V()&&!Y()&&(i.style.left=`${n}px`),!X()&&!W()&&(i.style.top=`${f}px`)):i.style.transform=`translate(${n}px, ${f}px)`}const Z=(o,r)=>{if(n=u.parsePositionValue(o,i,"x"),f=u.parsePositionValue(r,i,"y"),i instanceof HTMLElement){const p=getComputedStyle(i),l=p.position==="absolute"||p.position==="fixed",s=h=>{typeof h=="string"&&u.isCssUnitValue(h)&&l?i.style.left=h:i.style.left=`${n}px`},a=h=>{typeof h=="string"&&u.isCssUnitValue(h)&&l?i.style.top=h:i.style.top=`${f}px`};T&&!l?i.style.transform=`translate(${n}px, ${f}px)`:l?(i.style.right="",i.style.bottom="",s(o),a(r)):i.style.transform=`translate(${n}px, ${f}px)`}i instanceof Element&&(i.setAttribute("data-x",typeof o=="string"?o:n.toString()),i.setAttribute("data-y",typeof r=="string"?r:f.toString()))},v=(o,r)=>{if(m=typeof o=="number"?o:u.parseCssSize(o,i,"width"),y=typeof r=="number"?r:u.parseCssSize(r,i,"height"),i instanceof HTMLElement){const p=s=>{typeof s=="string"&&u.isCssUnitValue(s)?i.style.width=s:i.style.width=`${m}px`},l=s=>{typeof s=="string"&&u.isCssUnitValue(s)?i.style.height=s:i.style.height=`${y}px`};p(o),l(r)}i instanceof Element&&(i.setAttribute("data-width",typeof o=="string"?o:m.toString()),i.setAttribute("data-height",typeof r=="string"?r:y.toString()))};return{cleanup:()=>{R.forEach(o=>{o._mouseEnterListener&&o.removeEventListener("mouseenter",o._mouseEnterListener),o._mouseLeaveListener&&o.removeEventListener("mouseleave",o._mouseLeaveListener),o.remove()});try{L.unset()}catch(o){console.error("Error unsetting interactable:",o)}},updatePositionAndSize:(o,r,p,l)=>{Z(o,r),v(p,l)},updatePosition:Z,updateSize:v}}exports.makeElementDraggableResizable=Wt;
//# sourceMappingURL=interact-helper.cjs.map
